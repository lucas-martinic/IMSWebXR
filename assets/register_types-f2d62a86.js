import{s as h,R as qi,C as u,M as C,G as w,O as At,T as D,N as Ke,g as z,a as Qe,b as v,W as Ji,c as jt,d as X,A as he,I as Ki,e as nt,f as Qi,L as Zi,V as ts,h as ot,i as Y,j as $t,P as Ze,k as es,E as b,l as Fe,m as Be,n as Z,o as is,p as tt,q as A,r as de,t as pt,u as pe,v as Mt,S as ss,w as Ft,x as ti,y as ns,z as os,B as ue,D as ze,F as ei,H as rs,J as as,K as Ve,X as ls,Q as ii,U as cs,Y as te,Z as si,_ as hs,$ as p,a0 as ds,a1 as me,a2 as ni,a3 as oi,a4 as ri,a5 as ps,a6 as S,a7 as us,a8 as ms,a9 as ai}from"./needle-engine-3d59626a.js";import{V as M,P as fs,O as $,C as ut,M as li,a as ci,b as y,c as gs,d as fe,Q as dt,S as ys,A as vs,E as bs,e as ws,L as hi,R as di,f as pi}from"./three.module-9ae9c987.js";import"./index-2452cffd.js";var _s=Object.defineProperty,xs=Object.getOwnPropertyDescriptor,ui=(n,t,e,s)=>{for(var i=s>1?void 0:s?xs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&_s(t,e,i),i};class ge extends u{constructor(){super(...arguments),this.safeArea=new M(0,0)}update(){var i,o;const t=this.context.domWidth/this.safeArea.x,e=this.context.domHeight/this.safeArea.y,s=C.clamp(Math.min(t,e),0,1);(o=(i=this.rectTransform)==null?void 0:i.shadowComponent)==null||o.scale.setScalar(s)}}ui([h(qi)],ge.prototype,"rectTransform",2);ui([h(M)],ge.prototype,"safeArea",2);var Ps=Object.defineProperty,Os=Object.getOwnPropertyDescriptor,ye=(n,t,e,s)=>{for(var i=s>1?void 0:s?Os(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ps(t,e,i),i};class Bt extends u{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=w.findObjectOfType(At)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var s;this.menuButton&&this.removeButton();const t=((s=this.gameObject.getComponentInChildren(D))==null?void 0:s.text)??this.gameObject.name,e=document.createElement("button");this.menuButton=e,e.innerText=t.replace("_"," "),e.setAttribute("priority","40"),e.addEventListener("click",()=>this.use()),this.context.menu.appendChild(e)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var e,s;(e=this.orbitalCamera)==null||e.setCameraTargetPosition(this.worldPosition);const t=(s=Ke.active)==null?void 0:s.rig;if(this.teleportVRPlayer&&this.context.isInVR&&t){const i=z(this.worldPosition);this.ignoreYInVR&&(i.y=t.gameObject.worldPosition.y),t.gameObject.worldPosition=i}}}ye([h()],Bt.prototype,"createMenuButton",2);ye([h()],Bt.prototype,"teleportVRPlayer",2);ye([h()],Bt.prototype,"ignoreYInVR",2);class Ss extends u{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(Qe),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const t=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof fs&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=t}}var Cs=Object.defineProperty,Is=Object.getOwnPropertyDescriptor,zt=(n,t,e,s)=>{for(var i=s>1?void 0:s?Is(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Cs(t,e,i),i};class gt extends u{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=t=>{t.button===0&&this.throwBall(t.space.worldPosition,t.space.worldForward)}}start(){this.prefab&&w.setActive(this.prefab,!1),this.webXR??(this.webXR=w.findObjectOfType(Ji))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(t,e){var r,a;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const c=new Ki;c.position=t;const l=w.instantiate(this.prefab,c);if(!l)return;this._instances.push(l)}const s=++this._index,i=this._instances[s%this._instances.length];if(!i)return;jt(i,t),w.setActive(i,!0),(r=this.audioSource)==null||r.stop(),(a=this.audioSource)==null||a.play();const o=w.getComponent(i,X);o&&(e.multiplyScalar(this.strength),o.resetForcesAndTorques(),o.resetVelocities(),o==null||o.applyImpulse(e))}}zt([v($)],gt.prototype,"prefab",2);zt([v(he)],gt.prototype,"audioSource",2);zt([v()],gt.prototype,"strength",2);zt([v()],gt.prototype,"maxInstances",2);var Es=Object.defineProperty,Ds=Object.getOwnPropertyDescriptor,mi=(n,t,e,s)=>{for(var i=s>1?void 0:s?Ds(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Es(t,e,i),i};class ve extends u{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const t=this.gameObject.getComponent(nt);if(!t)return;for(let e=0;e<t.sharedMaterials.length;e++)t.sharedMaterials[e]=t.sharedMaterials[e].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const t=this.gameObject.getComponent(nt);if(!t){console.warn("Can not change color: No renderer on "+this.name);return}for(let e=0;e<t.sharedMaterials.length;e++){const s=t.sharedMaterials[e];s.color=new ut(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&s instanceof li&&(s.metalness=Math.random(),s.roughness=Math.random()*Math.random()),s.needsUpdate=!0,Qi.markDirty(this.gameObject)}}}mi([v()],ve.prototype,"applyOnStart",2);mi([v()],ve.prototype,"randomMetallicRoughness",2);class js extends u{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(nt),!!this.renderer){this._startColor||(this._startColor=[]);for(let t=0;t<this.renderer.sharedMaterials.length;t++)this.renderer.sharedMaterials[t]=this.renderer.sharedMaterials[t].clone(),this._startColor[t]=this.renderer.sharedMaterials[t].color.clone()}}onCollisionEnter(t){if(this.renderer){this.collisionCount+=1;for(let e=0;e<this.renderer.sharedMaterials.length;e++)this.renderer.sharedMaterials[e].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(t){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let e=0;e<this.renderer.sharedMaterials.length;e++)this.renderer.sharedMaterials[e].color.copy(this._startColor[e])}}var Ms=Object.defineProperty,Ts=Object.getOwnPropertyDescriptor,Rs=(n,t,e,s)=>{for(var i=s>1?void 0:s?Ts(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ms(t,e,i),i};class fi extends u{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}Rs([h(ci)],fi.prototype,"myMaterial",2);var Ls=Object.defineProperty,As=Object.getOwnPropertyDescriptor,gi=(n,t,e,s)=>{for(var i=s>1?void 0:s?As(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ls(t,e,i),i};class be extends u{constructor(){super(...arguments),this.tempVec1=new y,this.tempVec2=new y}update(){if(!this.lodGroup||!this.text)return;const t=this.context.mainCamera;t.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const e=this.tempVec1.distanceTo(this.tempVec2)/t.zoom,s=this.lodGroup._lodsHandler;let i=null;s==null||s.forEach(o=>{var l,g;const r=o.levels[o.getCurrentLevel()],a=o.levels.at(o.getCurrentLevel()+1);let c=null;if(r.object instanceof gs){const m=r.object.geometry.attributes,F=Math.floor(((l=m.position)==null?void 0:l.count)||0);c=`Triangles: ${Math.floor((((g=m.index)==null?void 0:g.count)||F)/3)}, Vertices: ${F}`}r.object.name.replace(/_/g,""),r.object.name.includes("Cull")||(i="",c&&(i+=`${c}
`),a==null||a.hysteresis,i+=`${r.distance.toFixed(1)} / ${e.toFixed(1)}`,a&&(i+=` / ${(a.distance-a.distance*a.hysteresis).toFixed(1)}`))}),i||(i="culled"),this.text.text=i}}gi([h(Zi)],be.prototype,"lodGroup",2);gi([h(D)],be.prototype,"text",2);var $s=Object.defineProperty,Fs=Object.getOwnPropertyDescriptor,we=(n,t,e,s)=>{for(var i=s>1?void 0:s?Fs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&$s(t,e,i),i};class Vt extends u{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var t,e,s;this.volume=w.findObjectOfType(ts),this.dofEffect=(s=(e=(t=this.volume)==null?void 0:t.sharedProfile)==null?void 0:e.components)==null?void 0:s.find(i=>i.typeName==="DepthOfField"),this.orbit=w.findObjectOfType(At)}onBeforeRender(){var e;if(!((e=this.orbit)!=null&&e.controls))return;const t=this.orbit.controls.target.distanceTo(ot(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=t,this.dofEffect.focalLength.value=this.focalLength;let s=C.inverseLerp(0,this.focusDistanceCutoff,t);s=C.clamp01(s),this.dofEffect.aperture.value=C.lerp(this.apertureMultiplier,32,s);const i=this.focusDistanceCutoff;t>i&&this.dofEffect.active?this.dofEffect.active=!1:t<i&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}we([h()],Vt.prototype,"apertureMultiplier",2);we([h()],Vt.prototype,"focalLength",2);we([h()],Vt.prototype,"focusDistanceCutoff",2);class Bs extends u{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var zs=Object.defineProperty,Vs=Object.getOwnPropertyDescriptor,Ns=(n,t,e,s)=>{for(var i=s>1?void 0:s?Vs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&zs(t,e,i),i};const Us=Y("sample_debugParticlesOnClick");class yi extends u{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const t=this.context.physics.raycast();t.length>0&&this.spawnParticlesAt(t[0].point)}}onUpdateXR(t){t.xr.controllers.forEach(e=>{var s,i;if(((s=e.getButton("primary"))==null?void 0:s.isDown)===!0){const o=(i=this.context.physics.raycastFromRay(e.ray))==null?void 0:i.at(0);o&&this.spawnParticlesAt(o.point)}})}spawnParticlesAt(t){jt(this.gameObject,t),Us&&$t.DrawWireSphere(t,.5,16711680,1);for(const e of this.particleSystems)e&&(w.setActive(e.gameObject,!0),e.play())}}Ns([v(Ze)],yi.prototype,"particleSystems",2);var ks=Object.defineProperty,Gs=Object.getOwnPropertyDescriptor,Hs=(n,t,e,s)=>{for(var i=s>1?void 0:s?Gs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&ks(t,e,i),i};class vi extends u{constructor(){super(...arguments),this.parameters=[]}awake(){var t=!1;this.parameters.forEach(e=>{Y(e)||(es(e,""),t=!0)}),t&&window.location.reload()}}Hs([h()],vi.prototype,"parameters",2);var Ws=Object.defineProperty,Xs=Object.getOwnPropertyDescriptor,bi=(n,t,e,s)=>{for(var i=s>1?void 0:s?Xs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ws(t,e,i),i};class _e extends u{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new b,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}bi([v()],_e.prototype,"htmlSelector",2);bi([h(b)],_e.prototype,"onClick",2);var Ys=Object.defineProperty,qs=Object.getOwnPropertyDescriptor,wi=(n,t,e,s)=>{for(var i=s>1?void 0:s?qs(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ys(t,e,i),i};const _i=class extends u{onEnable(){var n;if(!(!this.methods||!this.names)){console.log("HTMLMenu.onEnable"),this.wrapper=document.createElement("ul"),this.wrapper.classList.add("needle-menu");for(let t=0;t<this.methods.length;t++){const e=this.methods[t];let s="Button";t<((n=this.names)==null?void 0:n.length)&&(s=this.names[t]);const i=document.createElement("li"),o=document.createElement("button");o.innerHTML=s,o.onclick=()=>{e.invoke()},i.appendChild(o),this.wrapper.appendChild(i)}this.styleElement=document.createElement("style"),this.styleElement.innerHTML=_i.style,document.head.appendChild(this.styleElement),this.context.domElement.appendChild(this.wrapper)}}onDisable(){this.wrapper&&(this.wrapper.remove(),this.wrapper=void 0),this.styleElement&&(this.styleElement.remove(),this.styleElement=void 0)}};let Nt=_i;Nt.style=`
        .needle-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            list-style-type: none;
            margin: 0;
            overflow: hidden;
            background-color: white;
            display: flex;
            padding: 5px;
            border-radius: 20px;
        }

        .needle-menu li button {
            padding: 5px;
            margin: 0 5px;
            background: none;
            outline: none;
            border: 0;
            cursor: pointer;
        }

        .needle-menu li button:hover {
            font-weight: bold;
        }
    `;wi([h(b)],Nt.prototype,"methods",2);wi([h()],Nt.prototype,"names",2);const Ne=new y,Js=new dt,Ue=new y;class Ks extends ${constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}const N=new fe,Qs=new fe;class Zs{constructor(t={}){const e=this;let s,i,o,r;const a={camera:{style:""},objects:new WeakMap},c=t.element!==void 0?t.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",c.appendChild(l);const g=document.createElement("div");g.style.transformStyle="preserve-3d",l.appendChild(g),this.getSize=function(){return{width:s,height:i}},this.render=function(f,d){const E=d.projectionMatrix.elements[5]*r;d.view&&d.view.enabled?(l.style.transform=`translate( ${-d.view.offsetX*(s/d.view.width)}px, ${-d.view.offsetY*(i/d.view.height)}px )`,l.style.transform+=`scale( ${d.view.fullWidth/d.view.width}, ${d.view.fullHeight/d.view.height} )`):l.style.transform="",f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),d.parent===null&&d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld();let V,L;d.isOrthographicCamera&&(V=-(d.right+d.left)/2,L=(d.top+d.bottom)/2);const B=d.view&&d.view.enabled?d.view.height/d.view.fullHeight:1,at=d.isOrthographicCamera?`scale( ${B} )scale(`+E+")translate("+m(V)+"px,"+m(L)+"px)"+F(d.matrixWorldInverse):`scale( ${B} )translateZ(`+E+"px)"+F(d.matrixWorldInverse),lt=(d.isPerspectiveCamera?"perspective("+E+"px) ":"")+at+"translate("+o+"px,"+r+"px)";a.camera.style!==lt&&(g.style.transform=lt,a.camera.style=lt),G(f,f,d)},this.setSize=function(f,d){s=f,i=d,o=s/2,r=i/2,c.style.width=f+"px",c.style.height=d+"px",l.style.width=f+"px",l.style.height=d+"px",g.style.width=f+"px",g.style.height=d+"px"};function m(f){return Math.abs(f)<1e-10?0:f}function F(f){const d=f.elements;return"matrix3d("+m(d[0])+","+m(-d[1])+","+m(d[2])+","+m(d[3])+","+m(d[4])+","+m(-d[5])+","+m(d[6])+","+m(d[7])+","+m(d[8])+","+m(-d[9])+","+m(d[10])+","+m(d[11])+","+m(d[12])+","+m(-d[13])+","+m(d[14])+","+m(d[15])+")"}function k(f){const d=f.elements;return"translate(-50%,-50%)"+("matrix3d("+m(d[0])+","+m(d[1])+","+m(d[2])+","+m(d[3])+","+m(-d[4])+","+m(-d[5])+","+m(-d[6])+","+m(-d[7])+","+m(d[8])+","+m(d[9])+","+m(d[10])+","+m(d[11])+","+m(d[12])+","+m(d[13])+","+m(d[14])+","+m(d[15])+")")}function G(f,d,E,V){if(f.isCSS3DObject){const L=f.visible===!0&&f.layers.test(E.layers)===!0;if(f.element.style.display=L===!0?"":"none",L===!0){f.onBeforeRender(e,d,E);let B;f.isCSS3DSprite?(N.copy(E.matrixWorldInverse),N.transpose(),f.rotation2D!==0&&N.multiply(Qs.makeRotationZ(f.rotation2D)),f.matrixWorld.decompose(Ne,Js,Ue),N.setPosition(Ne),N.scale(Ue),N.elements[3]=0,N.elements[7]=0,N.elements[11]=0,N.elements[15]=1,B=k(N)):B=k(f.matrixWorld);const at=f.element,Zt=a.objects.get(f);if(Zt===void 0||Zt.style!==B){at.style.transform=B;const lt={style:B};a.objects.set(f,lt)}at.parentNode!==g&&g.appendChild(at),f.onAfterRender(e,d,E)}}for(let L=0,B=f.children.length;L<B;L++)G(f.children[L],d,E)}}}var tn=Object.defineProperty,en=Object.getOwnPropertyDescriptor,Ut=(n,t,e,s)=>{for(var i=s>1?void 0:s?en(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&tn(t,e,i),i};class yt extends u{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new dt().setFromAxisAngle(new y(0,1,0),Math.PI)}start(){const t=Y("url");t&&(this.url=t);const e=document.createElement("div");e.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',e.style.zIndex="10000",e.style.position="absolute",e.style.pointerEvents="initial";const s=e.querySelector("iframe");s.addEventListener("load",()=>{setTimeout(()=>{var c;console.log("Automatically opening iframe"),(c=this.animator)==null||c.SetBool("Open",!0)},1e3)}),s.src=this.url;let i=1e3;const o=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),r=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);i=Math.max(o,r),s.width=o+"px",s.height=r+"px",e.style.position="absolute",this.borderRadius>0&&(e.style.borderRadius=this.borderRadius+"px"),e.style.pointerEvents="initial",document.body.append(e),this.cssRenderer=new Zs,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new ys;const a=new Ks(e);a.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/i),jt(a,ot(this.gameObject)),Fe(a,Be(this.gameObject)),a.quaternion.multiply(this.rotate90),this.cssScene.add(a),this.cssObj=a,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;jt(this.cssObj,ot(this.gameObject)),Fe(this.cssObj,Be(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const t=this.context.mainCamera,e=this.gameObject;var s=t.position.clone().sub(this.gameObject.position).normalize(),i=e.getWorldDirection(new y);const o=s.dot(i);this.cssObj.visible=o<.15;const r=this.cssRenderer.getSize();(r.width!==this.context.domWidth||r.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}Ut([v()],yt.prototype,"url",2);Ut([v()],yt.prototype,"pixelsPerUnit",2);Ut([v()],yt.prototype,"borderRadius",2);Ut([v(Z)],yt.prototype,"animator",2);class sn extends u{constructor(){super(...arguments),this._ui=null}awake(){const t=w.findObjectsOfType(is),e=document.createElement("div");e.style.cssText=`
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(e),this._ui=e;const s=document.createElement("h2");s.style.cssText=`
            margin-bottom: .7em;
        `,s.innerText="Sample Images",e.appendChild(s);const i=document.createElement("p");i.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,i.style.userSelect="all",e.appendChild(i);for(const o of t)this.createDownloadImageUI(o,e)}update(){var t;this.context.isInAR?(t=this._ui)==null||t.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}createDownloadImageUI(t,e){if(t.trackedImages)for(const s of t.trackedImages){if(!s.image)continue;const i=document.createElement("a");i.href=s.image,e.appendChild(i);const o=document.createElement("img");o.src=s.image,o.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,i.appendChild(o)}}}var nn=Object.defineProperty,on=Object.getOwnPropertyDescriptor,kt=(n,t,e,s)=>{for(var i=s>1?void 0:s?on(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&nn(t,e,i),i};class ne extends u{onColorChanged(){typeof this.color=="number"&&(this.color=new ut(this.color)),this.setColorToMaterials()}onPointerClick(t){const e=new ut(Math.random(),Math.random(),Math.random());this.color=e}onEnable(){this.setColorToMaterials()}setColorToMaterials(){var e;const t=this.gameObject.getComponent(nt);if(t)for(let s=0;s<t.sharedMaterials.length;s++){const i=(e=t.sharedMaterials[s])==null?void 0:e.clone();t.sharedMaterials[s]=i,i&&"color"in i&&(i.color=this.color)}else console.warn("No renderer found",this.gameObject)}}kt([tt(ne.prototype.onColorChanged),h(ut)],ne.prototype,"color",2);class oe extends u{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const t=new Date().toLocaleTimeString();console.log("> Update array",t),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(t),this.myArray=this.myArray,A('<strong>> Sent</strong> "'+t+'", we now have '+this.myArray.length+" elements")}}awake(){A("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(de.JoinedRoom,async()=>{console.log("Will append a new value every 10 seconds"),setInterval(this.updateArray,1e4),await pt(100),this.updateArray()})}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),A('<strong>< Received</strong> "'+this.myArray[this.myArray.length-1]+'", we now have '+this.myArray.length+" elements")}}kt([tt(oe.prototype.onArrayChanged)],oe.prototype,"myArray",2);class rn{constructor(){this.name="",this.age=0}}class Tt extends u{constructor(){super(...arguments),this.myObject=new rn,this._mockAge=0,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this._mockAge+=1,this.myObject.age=this._mockAge,this.myObject=this.myObject,console.log("> Updated",this.myObject),A('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}awake(){A("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(de.JoinedRoom,async()=>{await pt(1),this.updateObject()})}onObjectChanged(){console.log("< Received object",this.myObject),A('<strong>< Received</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}kt([tt(Tt.prototype.onObjectChanged)],Tt.prototype,"myObject",2);kt([tt()],Tt.prototype,"_mockAge",2);var an=Object.defineProperty,ln=Object.getOwnPropertyDescriptor,xi=(n,t,e,s)=>{for(var i=s>1?void 0:s?ln(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&an(t,e,i),i};class xe extends u{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const t=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=t,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(t){this.maxFrameRate=t,this.clampFrameRate=!0}setClamping(t){this.clampFrameRate=t}}xi([h()],xe.prototype,"clampFrameRate",2);xi([h()],xe.prototype,"maxFrameRate",2);var cn=Object.defineProperty,hn=Object.getOwnPropertyDescriptor,K=(n,t,e,s)=>{for(var i=s>1?void 0:s?hn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&cn(t,e,i),i};class vt extends u{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(t){var e;this.logEvents&&console.log("ENTER",t),(e=this.onEnter)==null||e.invoke(t)}onCollisionStay(t){var e;this.logEvents&&console.log("STAY",t),(e=this.onStay)==null||e.invoke(t)}onCollisionExit(t){var e;this.logEvents&&console.log("EXIT",t),(e=this.onExit)==null||e.invoke(t)}}K([v(b)],vt.prototype,"onEnter",2);K([v(b)],vt.prototype,"onStay",2);K([v(b)],vt.prototype,"onExit",2);K([v()],vt.prototype,"logEvents",2);class bt extends u{onTriggerEnter(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onEnter)==null||s.invoke()}onTriggerStay(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onStay)==null||s.invoke()}onTriggerExit(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onExit)==null||s.invoke()}}K([v(w)],bt.prototype,"triggerObjects",2);K([v(b)],bt.prototype,"onEnter",2);K([v(b)],bt.prototype,"onStay",2);K([v(b)],bt.prototype,"onExit",2);var dn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,un=(n,t,e,s)=>{for(var i=s>1?void 0:s?pn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&dn(t,e,i),i};class Pi extends u{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(t){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}un([v(pe)],Pi.prototype,"animation",2);var mn=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,gn=(n,t,e,s)=>{for(var i=s>1?void 0:s?fn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&mn(t,e,i),i};class Oi extends u{onTriggerEnter(){var t,e;(t=this.animation)!=null&&t.isPlaying||(e=this.animation)==null||e.play(0,{loop:!1})}}gn([v(pe)],Oi.prototype,"animation",2);var yn=Object.defineProperty,vn=Object.getOwnPropertyDescriptor,bn=(n,t,e,s)=>{for(var i=s>1?void 0:s?vn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&yn(t,e,i),i};class Si extends u{onCollisionEnter(){var t,e;(t=this.audioSource)==null||t.stop(),(e=this.audioSource)==null||e.play()}}bn([v(he)],Si.prototype,"audioSource",2);var wn=Object.defineProperty,_n=Object.getOwnPropertyDescriptor,Ci=(n,t,e,s)=>{for(var i=s>1?void 0:s?_n(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&wn(t,e,i),i};class Pe extends u{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const t=this.context.domWidth/this.referenceSize;this.content.scale.set(t,t,t)}else Mt()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}Ci([h($)],Pe.prototype,"content",2);Ci([h()],Pe.prototype,"referenceSize",2);var xn=Object.defineProperty,Pn=Object.getOwnPropertyDescriptor,Oe=(n,t,e,s)=>{for(var i=s>1?void 0:s?Pn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&xn(t,e,i),i};class Ii extends u{async sceneOpened(){var t;(t=this.animator)==null||t.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var t,e;await pt(1e3),(t=this.animator)==null||t.setBool("SceneOpen",!1),await pt(1e3),(e=this._htmlElement)==null||e.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const t=document.createElement("img");t.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(t)}return this._htmlElement}}Oe([h(Z)],Ii.prototype,"animator",2);class Se extends u{sceneOpened(){var t;return Mt()&&console.log("Scene opened",this.name),(t=this.opened)==null||t.invoke(),Promise.resolve()}sceneClosing(){var t;return Mt()&&console.log("Scene closing",this.name),(t=this.closing)==null||t.invoke(),Promise.resolve()}}Oe([h(b)],Se.prototype,"opened",2);Oe([h(b)],Se.prototype,"closing",2);class On extends u{next(){var t;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(t=this.switcher)==null||t.selectNext()}previous(){var t;this.switcher??(this.switcher=this.get()),(t=this.switcher)==null||t.selectPrev()}get(){return w.findObjectOfType(ss)}}var Sn=Object.defineProperty,Cn=Object.getOwnPropertyDescriptor,In=(n,t,e,s)=>{for(var i=s>1?void 0:s?Cn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Sn(t,e,i),i};class Ei extends u{constructor(){super(...arguments),this.text=""}start(){A(this.text)}}In([h()],Ei.prototype,"text",2);var En=Object.defineProperty,Dn=Object.getOwnPropertyDescriptor,jn=(n,t,e,s)=>{for(var i=s>1?void 0:s?Dn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&En(t,e,i),i};const Mn=Y("testleaderboard");class re extends u{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(de.JoinedRoom,async()=>{await pt(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),Mn?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):Mt()&&A("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(t,e){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const s=10,i=this.data.scores;for(;i.length>=s;){this.sortScores();const o=i.pop();if(o.score>e){console.log(`Score ${e} is lower than ${o==null?void 0:o.score} (lowest score), ignoring`),i.push(o);return}}console.log("Inserting score",t,e),i.push({name:t,score:e}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((t,e)=>e.score-t.score)}onDataChanged(t){if(console.warn("Data changed!",t,this.data.scores),this.data.scores.length>0){const e=this.data.scores[0];A("HIGHSCORE - "+e.name+": "+e.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}jn([tt(re.prototype.onDataChanged)],re.prototype,"data",2);var Tn=Object.defineProperty,Rn=Object.getOwnPropertyDescriptor,Ln=(n,t,e,s)=>{for(var i=s>1?void 0:s?Rn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Tn(t,e,i),i};class Di extends u{start(){this.updateStartPosition()}updateStartPosition(){this.startPosition=this.gameObject.position.clone()}resetToStart(){if(!this.startPosition)return;const t=w.getComponent(this.gameObject,X);t==null||t.teleport(this.startPosition)}}class ji extends Di{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(t){t===this.worldCollider&&this.resetToStart()}}Ln([v(Ft)],ji.prototype,"worldCollider",2);var An=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,Fn=(n,t,e,s)=>{for(var i=s>1?void 0:s?$n(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&An(t,e,i),i};class Mi extends u{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const t=this.context.connection;let e=!1;t.currentRoomName&&t.currentRoomName!==this.roomId&&(this.roomId=t.currentRoomName,e=!0),t.usersInRoom().length!==this.playerCount&&(this.playerCount=t.usersInRoom().length,e=!0),e&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${t.connectionId}`)}}Fn([h(D)],Mi.prototype,"connectionLabel",2);var Bn=Object.defineProperty,zn=Object.getOwnPropertyDescriptor,Vn=(n,t,e,s)=>{for(var i=s>1?void 0:s?zn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Bn(t,e,i),i};class Ti extends u{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),A("TimedSpawn: no object to spawn",ti.Warn);return}w.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const t=w.instantiate(this.object);w.setActive(t,!0),this.spawned+=1,yield ns(this.interval/1e3)}}}Vn([v(w)],Ti.prototype,"object",2);class Nn extends u{async awake(){const t=document.createElement("video");t.style.cssText=`
            position: fixed;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
        `,this.context.domElement.shadowRoot.appendChild(t);const e=await navigator.mediaDevices.getUserMedia({video:!0});if(!e)return;t.srcObject=e,t.play();const s=this.context.mainCameraComponent;s&&(s.clearFlags=os.SolidColor,s.backgroundColor=new ue(125,125,125,0))}}var Un=Object.defineProperty,kn=Object.getOwnPropertyDescriptor,Gt=(n,t,e,s)=>{for(var i=s>1?void 0:s?kn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Un(t,e,i),i};class wt extends u{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const t=this.gameObject.position.clone(),e=this.gameObject.rotation.clone(),s=this.gameObject.getComponent(X),i=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(t),this.resetRotation&&this.gameObject.rotation.copy(e),s&&this.resetVelocity&&this.context.time.frame!==i&&s.resetVelocities()},this.interval*1e3)}}Gt([h()],wt.prototype,"interval",2);Gt([h()],wt.prototype,"resetPosition",2);Gt([h()],wt.prototype,"resetRotation",2);Gt([h()],wt.prototype,"resetVelocity",2);class Gn extends u{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(A('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const t=this.gameObject.getComponent(nt);t&&(t.enabled=!t.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var Hn=Object.defineProperty,Wn=Object.getOwnPropertyDescriptor,Xn=(n,t,e,s)=>{for(var i=s>1?void 0:s?Wn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Hn(t,e,i),i};class Ri extends u{awake(){this.material&&(this.material.wireframe=!0)}}Xn([h(ci)],Ri.prototype,"material",2);var Yn=Object.defineProperty,qn=Object.getOwnPropertyDescriptor,Li=(n,t,e,s)=>{for(var i=s>1?void 0:s?qn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Yn(t,e,i),i};class Ce extends u{constructor(){super(...arguments),this.onSessionStart=new b,this.onSessionEnd=new b}onEnterXR(t){this.onWebXRStarted()}onExitXR(t){this.onWebXREnded()}onWebXRStarted(){ze(this.context.scene,!1),this.onSessionStart.invoke()}onWebXREnded(){ze(this.context.scene,!1),this.onSessionEnd.invoke()}}Li([h(b)],Ce.prototype,"onSessionStart",2);Li([h(b)],Ce.prototype,"onSessionEnd",2);class Ai extends u{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(X)||void 0,this._rigidbody){const t=this.gameObject.getComponentsInChildren(Ft);for(const e of t){const s=w.addComponent(e.gameObject,Jn);s.rigidBody=this._rigidbody,s.arrow=this,s.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const t=this._rigidbody.getVelocity();if(t.lengthSq()>0){const e=z().set(t.x,t.y,t.z).normalize(),s=ei();s.setFromUnitVectors(z(0,0,1),e),this.gameObject.quaternion.copy(s)}}}}class Jn extends u{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(t){if(this.arrow)if(this.destroyTarget)t.gameObject.destroy(),this.arrow.gameObject.destroy();else{t.gameObject.attach(this.arrow.gameObject),t.rigidBody instanceof X&&t.rigidBody.applyImpulse(t.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const e=this.rigidBody.gameObject.getComponentsInChildren(Ft);for(const s of e)s.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var Kn=Object.defineProperty,Qn=Object.getOwnPropertyDescriptor,T=(n,t,e,s)=>{for(var i=s>1?void 0:s?Qn(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Kn(t,e,i),i};const Zn=Y("debugarrow");class j extends u{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this.desktopIdleDrawAmount=.25,this.interactionPixelOrigin=new M(.5,.65),this.interactionPixelTreshold=85,this.drawMaxPixelDistance=100,this._isAiming=!1,this._aimingPointerStartPos=new M(0,0),this._bowController=void 0,this._stringController=void 0,this.onDown=t=>{var e;if(t.origin instanceof Ve){if(t.button===0){this._isAiming=!0,this._bowController===void 0?this._bowController=t.origin.index:this._stringController===void 0&&(this._stringController=t.origin.index);const s=(e=this.bowObject)==null?void 0:e.getComponentInParent(ls);s&&(s.side=this._bowController)}}else t.button===0&&(this.getPointerDinstanceTo(this._aimingPointerStartPos,t.pointerId),this._isAiming=!0,this._aimingPointerId=t.pointerId)},this.onRelease=t=>{var e;if(t.button===0&&this._isAiming){if(this._isAiming=!1,this._aimingPointerId=void 0,t.origin instanceof Ve){const s=t.origin;if(s.index===this._stringController&&this._bowController!==void 0){const i=(e=Ke.active)==null?void 0:e.getController(this._bowController);if(s&&i){const o=s.gripWorldPosition;if(o){const r=i.gripWorldPosition.clone().sub(o);let a=i.object.worldPosition.distanceTo(s.object.worldPosition);a-=this.drawMinPhysicalDistance;const c=C.clamp01(a/this.drawMaxPhysicalDistance);r.normalize().multiplyScalar(c*this.power),this.shoot(o,r),Zn&&$t.DrawArrow(o,r.clone().add(o),16776960,1)}}}s.index===this._bowController&&(this._bowController=void 0),s.index===this._stringController&&(this._stringController=void 0)}else if(this.arrowSpawnSpot){const s=this.arrowSpawnSpot.getWorldPosition(z()),i=this.gameObject.getWorldDirection(z()),o=this.getPointerDinstanceTo(this._aimingPointerStartPos,t.pointerId),r=C.clamp01(o/this.drawMaxPixelDistance)*this.power;i.multiplyScalar(r),o>this.interactionPixelTreshold&&this.shoot(s,i)}}},this.shotStamp=Number.MIN_SAFE_INTEGER,this.fakeArrowRespawnDuration=.3,this._initRot=new dt,this._tempLookMatrix=new fe,this._tempLookRot=new dt,this._rotate90=new dt().setFromAxisAngle(new y(0,0,1),Math.PI/2),this.tempDir=new M,this.tempUpRef=new M}awake(){var t;(t=this.arrowPrefab)!=null&&t.asset&&(this.arrowPrefab.asset.visible=!1),this.bowObject&&this._initRot.copy(this.bowObject.quaternion),this.nonMountedParent=this.gameObject.parent,this.mount()}onEnable(){var t;(t=this.arrowPrefab)==null||t.loadAssetAsync(),this._isAiming=!1,this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupPreDraw()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}getPointerDinstanceTo(t,e){const s=this.context.input.getPointerPosition(e);return t.distanceTo(s)}async setupPreDraw(){var e,s;if(!this.arrowPrefab||!this.arrowSpawnSpot||this.fakeArrow)return;const t=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});t&&(t.visible=!0,t.worldScale=z(1,1,1),this.fakeArrow=t,(e=t.getComponent(Ai))==null||e.destroy(),(s=t.getComponent(X))==null||s.destroy(),t.getComponentsInChildren(Ft).forEach(i=>i.destroy()))}async shoot(t,e){var l,g;if(!this.arrowPrefab)return;this.shotStamp=this.context.time.time;const s=t.clone(),i=s.clone().add(e),o=Math.pow(e.length()+.5,2),r=e.clone().normalize(),a=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!a)return;a.worldPosition=s,a.lookAt(i),a.visible=!0;const c=a.getComponent(X);c&&(c.isKinematic=!1,c.autoMass=!1,c.mass=.05,(l=this.sound)==null||l.stop(),(g=this.sound)==null||g.play(),await ii(1),c.applyImpulse(r.multiplyScalar(o),!0))}mount(){this.cameraParent&&(this.gameObject.parent=this.cameraParent,this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1))}unmount(){this.gameObject.parent=this.nonMountedParent}get _hasControllers(){var t;return(((t=this.context.xr)==null?void 0:t.controllers.length)??0)>0}onEnterXR(t){(t.xr.isVR||t.xr.isPassThrough)&&this.unmount()}onLeaveXR(t){this.mount()}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new vs(this.bowObject);const o=this.animationComponent.animations.at(0);o&&(this._animation=this._mixer.clipAction(o))}const t=.1;let e=0;if(this._hasControllers){if(!this._isAiming)e=0;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const o=this.context.xr.controllers[this._stringController],r=this.context.xr.controllers[this._bowController];if(!o||!r)return;let a=z(0,1,0);!r.hand&&r.targetRayMode==="tracked-pointer"&&a.applyQuaternion(this._rotate90),a.applyQuaternion(r.gripWorldQuaternion).normalize(),this._tempLookMatrix.lookAt(o.gripWorldPosition,r.gripWorldPosition,a),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot;let c=o.object.worldPosition.distanceTo(r.object.worldPosition);c-=this.drawMinPhysicalDistance,e=C.clamp01(c/this.drawMaxPhysicalDistance)}}else{const o=this.interactionPixelOrigin;if(this._aimingPointerStartPos.set(this.context.domWidth*o.x,this.context.domHeight*o.y),!this._isAiming)e=this.desktopIdleDrawAmount;else{const r=this.context.input;if(this._aimingPointerId!=null){const a=this._aimingPointerStartPos,c=r.getPointerPosition(this._aimingPointerId),l=this.tempDir.copy(c).sub(a),m=l.length(),F=z();F.x=l.x,F.z=l.y,F.normalize();const k=this.gameObject.getWorldDirection(z());k.y=0,k.normalize();const G=F.dot(k),f=m>this.interactionPixelTreshold;(G>0||f)&&(e=C.clamp01(m/this.drawMaxPixelDistance)),this.tempUpRef.set(1,0);const E=this.tempUpRef.dot(l)>0?-1:1;this.tempUpRef.set(0,1);const V=this.tempUpRef.angleTo(l)*E;if(f){const L=ei().setFromAxisAngle(z().set(1,0,0),V);this.gameObject.quaternion.slerp(L,this.context.time.deltaTime/.05)}}}}this.drawProgression&&(e=this.drawProgression.evaluate(e)),this._animation.timeScale=0;const s=C.lerp(this._animation.time,e,this.context.time.deltaTime/t),i=this._animation.time;if(this._animation.time=s,Math.abs(s-i)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this.fakeArrow){let o=(this.context.time.time-this.shotStamp)/this.fakeArrowRespawnDuration;o=this.easeInOutSine(C.clamp01(o)),this.fakeArrow.worldScale=z(1,1,1).multiplyScalar(o)}}easeInOutSine(t){return C.clamp01(-.5*(Math.cos(Math.PI*t)-1))}}T([h()],j.prototype,"power",2);T([h()],j.prototype,"drawMaxPhysicalDistance",2);T([h()],j.prototype,"drawMinPhysicalDistance",2);T([h(rs)],j.prototype,"drawProgression",2);T([h($)],j.prototype,"cameraParent",2);T([h()],j.prototype,"desktopIdleDrawAmount",2);T([h(M)],j.prototype,"interactionPixelOrigin",2);T([h()],j.prototype,"interactionPixelTreshold",2);T([h()],j.prototype,"drawMaxPixelDistance",2);T([h($)],j.prototype,"bowObject",2);T([h(pe)],j.prototype,"animationComponent",2);T([h(as)],j.prototype,"arrowPrefab",2);T([h($)],j.prototype,"arrowSpawnSpot",2);T([h(he)],j.prototype,"sound",2);T([h()],j.prototype,"fakeArrowRespawnDuration",2);var to=Object.defineProperty,eo=Object.getOwnPropertyDescriptor,io=(n,t,e,s)=>{for(var i=s>1?void 0:s?eo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&to(t,e,i),i};class $i extends u{start(){this._meshRenderer=this.gameObject.getComponentInChildren(cs)}onDestroy(){if(this.particleSystem){if(this.particleSystem.shape.shapeType===te.MeshRenderer&&this._meshRenderer&&!si(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=te.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=te.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}io([h(Ze)],$i.prototype,"particleSystem",2);var so=Object.defineProperty,no=Object.getOwnPropertyDescriptor,oo=(n,t,e,s)=>{for(var i=s>1?void 0:s?no(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&so(t,e,i),i};class Fi extends u{constructor(){super(...arguments),this._instances=new Array}awake(){var t,e;if(!((t=this.prefabs)!=null&&t.length)||((e=this.prefabs)==null?void 0:e.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(s=>s.visible=!1)}update(){var e;if(!((e=this.prefabs)!=null&&e.length))return;const t=z();for(let s=this._instances.length-1;s>=0;s--){const i=this._instances[s];si(i.instance)?this._instances.splice(s,1):(t.setScalar(i.scale),i.instance.scale.lerp(t,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const s=this.worldPosition;s.x+=Math.random()*12-6,s.y+=Math.random()*3,s.z+=Math.random()*6;const i=Math.random()*3+.5,o=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],r=hs(o,{parent:this.scene,position:s.clone(),scale:new y(.01,.01,.01),keepWorldPosition:!0});r.visible=!0,this._instances.push({instance:r,scale:i}),setTimeout(()=>{r.destroy()},7e3),ii(1).then(()=>{const a=r.getComponentInChildren(X);a&&(a.gravityScale=.2+Math.random()*.3,a.mass=2,a.autoMass=!1),a==null||a.setAngularVelocity(C.random(-2,2),C.random(-2,2),C.random(-2,2)),a==null||a.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}oo([h($)],Fi.prototype,"prefabs",2);var ro=Object.defineProperty,ao=Object.getOwnPropertyDescriptor,lo=(n,t,e,s)=>{for(var i=s>1?void 0:s?ao(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&ro(t,e,i),i};class Ie extends u{constructor(){super(...arguments),this.displayName=""}}lo([h()],Ie.prototype,"displayName",2);var co=Object.defineProperty,ho=Object.getOwnPropertyDescriptor,Ee=(n,t,e,s)=>{for(var i=s>1?void 0:s?ho(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&co(t,e,i),i};class Ht extends u{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0),this.apply()}next(){this.index++,this.index>=this.objects.length&&(this.index=0),this.apply()}previous(){this.index--,this.index<0&&(this.index=this.objects.length-1),this.apply()}apply(){for(let t=0;t<this.objects.length;t++)this.objects[t].visible=t===this.index;if(this.lable){const t=this.objects[this.index];if(t){const e=w.getComponent(t,Ie);this.lable.text=(e==null?void 0:e.displayName)??t.name}}}select(t){this.index=t,this.index=C.clamp(this.index,0,this.objects.length-1),this.apply()}}Ee([h($)],Ht.prototype,"objects",2);Ee([h()],Ht.prototype,"hideContentOnStart",2);Ee([h(D)],Ht.prototype,"lable",2);p.add("AspectRatioFitterUI",ge);p.add("CameraGoal",Bt);p.add("CameraLayer",Ss);p.add("Cannon",gt);p.add("RandomColor",ve);p.add("ChangeColorOnCollision",js);p.add("IncreaseShaderSpeedOverTime",fi);p.add("DebugLOD",be);p.add("DepthOfFieldController",Vt);p.add("DisableEnvironmentLight",Bs);p.add("EmitParticlesOnClick",yi);p.add("EnforceParameters",vi);p.add("HTMLButtonClick",_e);p.add("HTMLMenu",Nt);p.add("IFrameContent",yt);p.add("ImageTrackingDownloadUI",sn);p.add("Networking_ClickToChangeColor",ne);p.add("Networking_StringArray",oe);p.add("Networking_Object",Tt);p.add("PerformanceSettings",xe);p.add("PhysicsCollision",vt);p.add("PhysicsTrigger",bt);p.add("PlayAnimationOnCollision",Pi);p.add("PlayAnimationOnTrigger",Oi);p.add("PlayAudioOnCollision",Si);p.add("ResponsiveContent",Pe);p.add("LoadingSceneRoot",Ii);p.add("SceneLoadingEvents",Se);p.add("SceneSwitcherControls",On);p.add("ShowBalloonMessage",Ei);p.add("SimpleLeaderboard",re);p.add("StartPosition",Di);p.add("AutoReset",ji);p.add("SyncedRoomUI",Mi);p.add("TimedSpawn",Ti);p.add("VideoBackground",Nn);p.add("ResetPositionOnInterval",wt);p.add("ToggleVisibility",Gn);p.add("WireframeMaterial",Ri);p.add("XRLifecycleEvents",Ce);p.add("Arrow",Ai);p.add("ArrowShooting",j);p.add("BowArrowTarget",$i);p.add("BowTargetSpawner",Fi);p.add("VariantInfo",Ie);p.add("VariantSwitcher",Ht);var ct=Y("pointerlockdebug");const It=class extends bs{constructor(n){super(),this.domElement=n,this._onMouseMove=this.onMouseMove.bind(this),this._onPointerlockChange=this.onPointerlockChange.bind(this),this._onPointerlockError=this.onPointerlockError.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),ct&&this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),ct&&this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}async lock(){ct&&console.log("Locking pointer");try{await this.domElement.requestPointerLock()}catch{ct&&console.log("Locking pointer")}}unlock(){ct&&console.log("Locking pointer"),this.domElement.ownerDocument.exitPointerLock()}onMouseMove(){It.IsLocked}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?It.IsLocked=!0:It.IsLocked=!1}onPointerlockError(){console.error("PointerLock: Unable to use Pointer Lock API")}};let it=It;it.IsLocked=!1;var po=Object.defineProperty,uo=Object.getOwnPropertyDescriptor,R=(n,t,e,s)=>{for(var i=s>1?void 0:s?uo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&po(t,e,i),i};class I extends u{constructor(){super(...arguments),this.lookSensitivity=1,this.movementSpeed=50,this.sprintSpeed=80,this.stoppingDecay=7,this.maxSpeed=7,this.maxSprintSpeed=7,this.jumpSpeed=5,this.xRotClamp=new M(-89,89),this.enableTouchInput=!0,this.enableDesktopInput=!0,this.enableGamepadInput=!0,this.gamepadDeadzone=.25,this.gamepadLookSensitivity=50,this.isMobile=!1,this.x=0,this.y=0,this.lookInput=new M,this.moveInput=new M,this.jumpInput=!1,this.sprintInput=!1,this.gamepadIndex=null,this.isInitialized=!1,this.pointerMoveFn=null,this.gamePadConnFn=null,this.gamePadDisconnFn=null,this.upVector=new y(0,1,0),this.moveDir=new y,this.fwdDir=new y,this.upDir=new y(0,1,0),this.rightDir=new y,this.jumpVec=new y,this.zeroValue=new y}awake(){this.playerState=this.gameObject.getComponent(me),this.syncedTransform=this.gameObject.getComponent(ni),this.mainCamera=this.gameObject.getComponentInChildren(Qe),this.isMultiplayer()?this.playerState.onOwnerChangeEvent.addEventListener(()=>this.onOwnerChanged()):this.onOwnerChanged()}start(){this.calculateYRot()}initialize(){this.isInitialized=!0,this.yRotTarget=this.gameObject,this.isMobile=oi(),this.lock=new it(this.context.domElement),this.isMobile&&(this.lookSensitivity*=2);const t=window.devicePixelRatio;t>1&&(this.lookSensitivity*=t),this.isMobile&&(this.context.domElement.style.userSelect="none",this.context.domElement.style.touchAction="none",this.context.renderer.domElement.style.touchAction="none")}registerInput(){this.pointerMoveFn??(this.pointerMoveFn=this._onPointerMove.bind(this)),this.gamePadConnFn??(this.gamePadConnFn=this.onGamepadConnected.bind(this)),this.gamePadDisconnFn??(this.gamePadDisconnFn=this.onGamepadDisconnected.bind(this)),this.enableDesktopInput&&window.addEventListener("pointermove",this.pointerMoveFn),window.addEventListener("gamepadconnected",this.gamePadConnFn),window.addEventListener("gamepaddisconnected",this.gamePadDisconnFn),this.context.renderer.domElement.addEventListener("pointerdown",()=>{this.enableDesktopInput&&!it.IsLocked&&!this.isMobile&&this.lock.lock()})}unregisterInput(){window.removeEventListener("pointermove",this.pointerMoveFn),window.removeEventListener("gamepadconnected",this.gamePadConnFn),window.removeEventListener("gamepaddisconnected",this.gamePadDisconnFn)}onOwnerChanged(){this.destroyed||(this.isInitialized||this.initialize(),this.setRole(this.isLocalPlayer()))}calculateYRot(){var o;const t=new y;(o=this.yRotTarget)==null||o.getWorldDirection(t),t.y=0,t.normalize();const e=new y(0,0,1),i=new y(1,0,0).dot(t)>0?1:-1;this.y=e.angleTo(t)*i}isMultiplayer(){return this.playerState!=null&&this.context.connection.isInRoom}isLocalPlayer(){return this.playerState!=null&&this.playerState.isLocalPlayer||!this.isMultiplayer()}setRole(t){var e;this.controller&&(this.controller.enabled=t,this.controller.rigidbody.isKinematic=!t),this.enabled=t,t?((e=this.syncedTransform)==null||e.requestOwnership(),this.registerInput()):this.unregisterInput(),this.mainCamera&&(this.mainCamera.enabled=t)}onBeforeRender(){this.isInitialized&&(this.enableTouchInput&&this.isMobile&&this.gatherMobileInput(),this.enableDesktopInput&&it.IsLocked&&this.gatherDesktopInput(),this.enableGamepadInput&&this.gatherGamepadInput(),this.handleMove(this.moveInput,this.jumpInput,this.sprintInput,()=>this.jumpInput=!1),this.handleLookVec(this.lookInput),this.moveInput.set(0,0),this.lookInput.set(0,0),this.sprintInput=!1)}gatherMobileInput(){const t=this.context.input.getPointerPositionDelta(0);t&&this.lookInput.copy(t)}gatherDesktopInput(){const t=this.context.input;t.isKeyPressed("s")||t.isKeyPressed("DownArrow")?this.moveInput.y+=-1:(t.isKeyPressed("w")||t.isKeyPressed("UpArrow"))&&(this.moveInput.y+=1),t.isKeyPressed("d")||t.isKeyPressed("RightArrow")?this.moveInput.x+=1:(t.isKeyPressed("a")||t.isKeyPressed("LeftArrow"))&&(this.moveInput.x+=-1),t.isKeyDown(" ")?this.jumpInput||(this.jumpInput=!0):t.isKeyUp(" ")&&(this.jumpInput=!1),this.sprintInput||(this.sprintInput=t.isKeyPressed("Shift"))}gatherGamepadInput(){if(this.gamepadIndex===null)return;const t=navigator.getGamepads()[this.gamepadIndex];if(!t)return;const e=this.sanitzeGamepadAxis.bind(this);t.axes.length>=2&&(this.lookInput.x+=e(t.axes[0])*this.gamepadLookSensitivity,this.lookInput.y+=e(t.axes[1])*this.gamepadLookSensitivity),t.axes.length>=4&&(this.moveInput.x+=e(t.axes[2]),this.moveInput.y+=e(-t.axes[3])),this.jumpInput||(this.jumpInput=this.getGamepadButtons(t,[0,4,5,6])),this.sprintInput||(this.sprintInput=this.getGamepadButtons(t,[7,11]))}getGamepadButtons(t,e){let s=!1;return e.forEach(i=>{var o;s=s||((o=t.buttons[i])==null?void 0:o.pressed)||!1}),s}sanitzeGamepadAxis(t){return t==null?0:(t>=-this.gamepadDeadzone&&t<=this.gamepadDeadzone&&(t=0),t)}_onPointerMove(t){if(t instanceof MouseEvent){if(!it.IsLocked||this.isMobile||!this.enabled)return;this.handleLookNum(t.movementX,t.movementY)}}onGamepadConnected(t){t.gamepad.mapping=="standard"&&(this.gamepadIndex=t.gamepad.index)}onGamepadDisconnected(t){this.gamepadIndex==t.gamepad.index&&(this.gamepadIndex=null)}move(t){this.moveInput.copy(t)}jump(){this.jumpInput=!0}sprint(t){this.sprintInput=t}look(t){this.lookInput.copy(t)}handleLookVec(t){this.handleLookNum(t.x,t.y)}handleLookNum(t,e){var o;const s=-e/this.context.domHeight*this.lookSensitivity,i=-t/this.context.domWidth*this.lookSensitivity;this.x=ws.clamp(this.x+s,C.toRadians(this.xRotClamp.x),C.toRadians(this.xRotClamp.y)),this.y+=i,(o=this.yRotTarget)==null||o.setRotationFromAxisAngle(this.upVector,this.y),this.xRotTarget&&(this.xRotTarget.rotation.x=-this.x+Math.PI)}handleMove(t,e,s,i){if(!this.controller)return;const o=this.context.time.deltaTime;this.gameObject.getWorldDirection(this.fwdDir),this.rightDir.crossVectors(this.upDir,this.fwdDir),this.moveDir.set(0,0,0),this.moveDir.add(this.fwdDir.multiplyScalar(t.y)),this.moveDir.add(this.rightDir.multiplyScalar(-t.x)),this.moveDir.clampLength(0,1);const r=s?this.sprintSpeed:this.movementSpeed;this.moveDir.multiplyScalar(r*o);const a=this.controller.rigidbody;if(e&&this.controller.isGrounded){this.jumpVec.set(0,1,0),this.jumpVec.multiplyScalar(this.jumpSpeed);const m=a.getVelocity();m.y=0,a.setVelocity(m),a.applyImpulse(this.jumpVec),i==null||i()}a.applyImpulse(this.moveDir);const c=a.getVelocity(),l=c.y,g=s?this.maxSprintSpeed:this.maxSpeed;c.y=0,c.clampLength(0,g),c.y=l,a.setVelocity(c)}}R([h(ds)],I.prototype,"controller",2);R([h($)],I.prototype,"xRotTarget",2);R([h()],I.prototype,"lookSensitivity",2);R([h()],I.prototype,"movementSpeed",2);R([h()],I.prototype,"sprintSpeed",2);R([h()],I.prototype,"stoppingDecay",2);R([h()],I.prototype,"maxSpeed",2);R([h()],I.prototype,"maxSprintSpeed",2);R([h()],I.prototype,"jumpSpeed",2);R([h(M)],I.prototype,"xRotClamp",2);R([h()],I.prototype,"enableTouchInput",2);R([h()],I.prototype,"enableDesktopInput",2);R([h()],I.prototype,"enableGamepadInput",2);R([h()],I.prototype,"gamepadDeadzone",2);R([h()],I.prototype,"gamepadLookSensitivity",2);const Et=(n,t)=>{const e=t.x-n.x,s=t.y-n.y;return Math.sqrt(e*e+s*s)},mo=(n,t)=>{const e=t.x-n.x,s=t.y-n.y;return go(Math.atan2(s,e))},fo=(n,t,e)=>{const s={x:0,y:0};return e=ae(e),s.x=n.x-t*Math.cos(e),s.y=n.y-t*Math.sin(e),s},ae=n=>n*(Math.PI/180),go=n=>n*(180/Math.PI),yo=n=>isNaN(n.buttons)?n.pressure!==0:n.buttons!==0,ee=new Map,ke=n=>{ee.has(n)&&clearTimeout(ee.get(n)),ee.set(n,setTimeout(n,100))},Rt=(n,t,e)=>{const s=t.split(/[ ,]+/g);let i;for(let o=0;o<s.length;o+=1)i=s[o],n.addEventListener?n.addEventListener(i,e,!1):n.attachEvent&&n.attachEvent(i,e)},Ge=(n,t,e)=>{const s=t.split(/[ ,]+/g);let i;for(let o=0;o<s.length;o+=1)i=s[o],n.removeEventListener?n.removeEventListener(i,e):n.detachEvent&&n.detachEvent(i,e)},Bi=n=>(n.preventDefault(),n.type.match(/^touch/)?n.changedTouches:n),He=()=>{const n=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:n,y:t}},We=(n,t)=>{t.top||t.right||t.bottom||t.left?(n.style.top=t.top,n.style.right=t.right,n.style.bottom=t.bottom,n.style.left=t.left):(n.style.left=t.x+"px",n.style.top=t.y+"px")},De=(n,t,e)=>{const s=zi(n);for(let i in s)if(s.hasOwnProperty(i))if(typeof t=="string")s[i]=t+" "+e;else{let o="";for(let r=0,a=t.length;r<a;r+=1)o+=t[r]+" "+e+", ";s[i]=o.slice(0,-2)}return s},vo=(n,t)=>{const e=zi(n);for(let s in e)e.hasOwnProperty(s)&&(e[s]=t);return e},zi=n=>{const t={};return t[n]="",["webkit","Moz","o"].forEach(function(s){t[s+n.charAt(0).toUpperCase()+n.slice(1)]=""}),t},ie=(n,t)=>{for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n},bo=(n,t)=>{const e={};for(let s in n)n.hasOwnProperty(s)&&t.hasOwnProperty(s)?e[s]=t[s]:n.hasOwnProperty(s)&&(e[s]=n[s]);return e},le=(n,t)=>{if(n.length)for(let e=0,s=n.length;e<s;e+=1)t(n[e]);else t(n)},wo=(n,t,e)=>({x:Math.min(Math.max(n.x,t.x-e),t.x+e),y:Math.min(Math.max(n.y,t.y-e),t.y+e)});var _o="ontouchstart"in window,xo=!!window.PointerEvent,Po=!!window.MSPointerEvent,ht={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},st,mt={};xo?st=ht.pointer:Po?st=ht.MSPointer:_o?(st=ht.touch,mt=ht.mouse):st=ht.mouse;function q(){}q.prototype.on=function(n,t){var e=this,s=n.split(/[ ,]+/g),i;e._handlers_=e._handlers_||{};for(var o=0;o<s.length;o+=1)i=s[o],e._handlers_[i]=e._handlers_[i]||[],e._handlers_[i].push(t);return e};q.prototype.off=function(n,t){var e=this;return e._handlers_=e._handlers_||{},n===void 0?e._handlers_={}:t===void 0?e._handlers_[n]=null:e._handlers_[n]&&e._handlers_[n].indexOf(t)>=0&&e._handlers_[n].splice(e._handlers_[n].indexOf(t),1),e};q.prototype.trigger=function(n,t){var e=this,s=n.split(/[ ,]+/g),i;e._handlers_=e._handlers_||{};for(var o=0;o<s.length;o+=1)i=s[o],e._handlers_[i]&&e._handlers_[i].length&&e._handlers_[i].forEach(function(r){r.call(e,{type:i,target:e},t)})};q.prototype.config=function(n){var t=this;t.options=t.defaults||{},n&&(t.options=bo(t.options,n))};q.prototype.bindEvt=function(n,t){var e=this;return e._domHandlers_=e._domHandlers_||{},e._domHandlers_[t]=function(){typeof e["on"+t]=="function"?e["on"+t].apply(e,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Rt(n,st[t],e._domHandlers_[t]),mt[t]&&Rt(n,mt[t],e._domHandlers_[t]),e};q.prototype.unbindEvt=function(n,t){var e=this;return e._domHandlers_=e._domHandlers_||{},Ge(n,st[t],e._domHandlers_[t]),mt[t]&&Ge(n,mt[t],e._domHandlers_[t]),delete e._domHandlers_[t],this};function x(n,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=n,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}x.prototype=new q;x.constructor=x;x.id=0;x.prototype.buildEl=function(n){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};x.prototype.stylize=function(){if(this.options.dataOnly)return this;var n=this.options.fadeTime+"ms",t=vo("borderRadius","50%"),e=De("transition","opacity",n),s={};return s.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},s.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},s.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},ie(s.el,e),this.options.shape==="circle"&&ie(s.back,t),ie(s.front,t),this.applyStyles(s),this};x.prototype.applyStyles=function(n){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var e in n[t])this.ui[t].style[e]=n[t][e];return this};x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};x.prototype.show=function(n){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof n=="function"&&n.call(this)},t.options.fadeTime)),t};x.prototype.hide=function(n){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var e=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=e,typeof n=="function"&&n.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const e=t.options.restJoystick,s={};s.x=e===!0||e.x!==!1?0:t.instance.frontPosition.x,s.y=e===!0||e.y!==!1?0:t.instance.frontPosition.y,t.setPosition(n,s)}return t};x.prototype.setPosition=function(n,t){var e=this;e.frontPosition={x:t.x,y:t.y};var s=e.options.fadeTime+"ms",i={};i.front=De("transition",["transform"],s);var o={front:{}};o.front={transform:"translate("+e.frontPosition.x+"px,"+e.frontPosition.y+"px)"},e.applyStyles(i),e.applyStyles(o),e.restTimeout=setTimeout(function(){typeof n=="function"&&n.call(e),e.restCallback()},e.options.fadeTime)};x.prototype.restCallback=function(){var n=this,t={};t.front=De("transition","none",""),n.applyStyles(t),n.trigger("rested",n.instance)};x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};x.prototype.computeDirection=function(n){var t=n.angle.radian,e=Math.PI/4,s=Math.PI/2,i,o,r;if(t>e&&t<e*3&&!n.lockX?i="up":t>-e&&t<=e&&!n.lockY?i="left":t>-e*3&&t<=-e&&!n.lockX?i="down":n.lockY||(i="right"),n.lockY||(t>-s&&t<s?o="left":o="right"),n.lockX||(t>0?r="up":r="down"),n.force>this.options.threshold){var a={},c;for(c in this.direction)this.direction.hasOwnProperty(c)&&(a[c]=this.direction[c]);var l={};this.direction={x:o,y:r,angle:i},n.direction=this.direction;for(c in a)a[c]===this.direction[c]&&(l[c]=!0);if(l.x&&l.y&&l.angle)return n;(!l.x||!l.y)&&this.trigger("plain",n),l.x||this.trigger("plain:"+o,n),l.y||this.trigger("plain:"+r,n),l.angle||this.trigger("dir dir:"+i,n)}else this.resetDirection();return n};function _(n,t){var e=this;e.nipples=[],e.idles=[],e.actives=[],e.ids=[],e.pressureIntervals={},e.manager=n,e.id=_.id,_.id+=1,e.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},e.config(t),(e.options.mode==="static"||e.options.mode==="semi")&&(e.options.multitouch=!1),e.options.multitouch||(e.options.maxNumberOfNipples=1);const s=getComputedStyle(e.options.zone.parentElement);return s&&s.display==="flex"&&(e.parentIsFlex=!0),e.updateBox(),e.prepareNipples(),e.bindings(),e.begin(),e.nipples}_.prototype=new q;_.constructor=_;_.id=0;_.prototype.prepareNipples=function(){var n=this,t=n.nipples;t.on=n.on.bind(n),t.off=n.off.bind(n),t.options=n.options,t.destroy=n.destroy.bind(n),t.ids=n.ids,t.id=n.id,t.processOnMove=n.processOnMove.bind(n),t.processOnEnd=n.processOnEnd.bind(n),t.get=function(e){if(e===void 0)return t[0];for(var s=0,i=t.length;s<i;s+=1)if(t[s].identifier===e)return t[s];return!1}};_.prototype.bindings=function(){var n=this;n.bindEvt(n.options.zone,"start"),n.options.zone.style.touchAction="none",n.options.zone.style.msTouchAction="none"};_.prototype.begin=function(){var n=this,t=n.options;if(t.mode==="static"){var e=n.createNipple(t.position,n.manager.getIdentifier());e.add(),n.idles.push(e)}};_.prototype.createNipple=function(n,t){var e=this,s=e.manager.scroll,i={},o=e.options,r={x:e.parentIsFlex?s.x:s.x+e.box.left,y:e.parentIsFlex?s.y:s.y+e.box.top};if(n.x&&n.y)i={x:n.x-r.x,y:n.y-r.y};else if(n.top||n.right||n.bottom||n.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=n.top,a.style.right=n.right,a.style.bottom=n.bottom,a.style.left=n.left,a.style.position="absolute",o.zone.appendChild(a);var c=a.getBoundingClientRect();o.zone.removeChild(a),i=n,n={x:c.left+s.x,y:c.top+s.y}}var l=new x(e,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:n,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(We(l.ui.el,i),We(l.ui.front,l.frontPosition)),e.nipples.push(l),e.trigger("added "+l.identifier+":added",l),e.manager.trigger("added "+l.identifier+":added",l),e.bindNipple(l),l};_.prototype.updateBox=function(){var n=this;n.box=n.options.zone.getBoundingClientRect()};_.prototype.bindNipple=function(n){var t=this,e,s=function(i,o){e=i.type+" "+o.id+":"+i.type,t.trigger(e,o)};n.on("destroyed",t.onDestroyed.bind(t)),n.on("shown hidden rested dir plain",s),n.on("dir:up dir:right dir:down dir:left",s),n.on("plain:up plain:right plain:down plain:left",s)};_.prototype.pressureFn=function(n,t,e){var s=this,i=0;clearInterval(s.pressureIntervals[e]),s.pressureIntervals[e]=setInterval(function(){var o=n.force||n.pressure||n.webkitForce||0;o!==i&&(t.trigger("pressure",o),s.trigger("pressure "+t.identifier+":pressure",o),i=o)}.bind(s),100)};_.prototype.onstart=function(n){var t=this,e=t.options,s=n;n=Bi(n),t.updateBox();var i=function(o){t.actives.length<e.maxNumberOfNipples?t.processOnStart(o):s.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(r){if(Object.values(s.touches).findIndex(function(c){return c.identifier===r})<0){var a=[n[0]];a.identifier=r,t.processOnEnd(a)}}),t.actives.length<e.maxNumberOfNipples&&t.processOnStart(o))};return le(n,i),t.manager.bindDocument(),!1};_.prototype.processOnStart=function(n){var t=this,e=t.options,s,i=t.manager.getIdentifier(n),o=n.force||n.pressure||n.webkitForce||0,r={x:n.pageX,y:n.pageY},a=t.getOrCreate(i,r);a.identifier!==i&&t.manager.removeIdentifier(a.identifier),a.identifier=i;var c=function(g){g.trigger("start",g),t.trigger("start "+g.id+":start",g),g.show(),o>0&&t.pressureFn(n,g,g.identifier),t.processOnMove(n)};if((s=t.idles.indexOf(a))>=0&&t.idles.splice(s,1),t.actives.push(a),t.ids.push(a.identifier),e.mode!=="semi")c(a);else{var l=Et(r,a.position);if(l<=e.catchDistance)c(a);else{a.destroy(),t.processOnStart(n);return}}return a};_.prototype.getOrCreate=function(n,t){var e=this,s=e.options,i;return/(semi|static)/.test(s.mode)?(i=e.idles[0],i?(e.idles.splice(0,1),i):s.mode==="semi"?e.createNipple(t,n):(console.warn("Coudln't find the needed nipple."),!1)):(i=e.createNipple(t,n),i)};_.prototype.processOnMove=function(n){var t=this,e=t.options,s=t.manager.getIdentifier(n),i=t.nipples.get(s),o=t.manager.scroll;if(!yo(n)){this.processOnEnd(n);return}if(!i){console.error("Found zombie joystick with ID "+s),t.manager.removeIdentifier(s);return}if(e.dynamicPage){var r=i.el.getBoundingClientRect();i.position={x:o.x+r.left,y:o.y+r.top}}i.identifier=s;var a=i.options.size/2,c={x:n.pageX,y:n.pageY};e.lockX&&(c.y=i.position.y),e.lockY&&(c.x=i.position.x);var l=Et(c,i.position),g=mo(c,i.position),m=ae(g),F=l/a,k={distance:l,position:c},G,f;if(i.options.shape==="circle"?(G=Math.min(l,a),f=fo(i.position,G,g)):(f=wo(c,i.position,a),G=Et(f,i.position)),e.follow){if(l>a){let L=c.x-f.x,B=c.y-f.y;i.position.x+=L,i.position.y+=B,i.el.style.top=i.position.y-(t.box.top+o.y)+"px",i.el.style.left=i.position.x-(t.box.left+o.x)+"px",l=Et(c,i.position)}}else c=f,l=G;var d=c.x-i.position.x,E=c.y-i.position.y;i.frontPosition={x:d,y:E},e.dataOnly||(i.ui.front.style.transform="translate("+d+"px,"+E+"px)");var V={identifier:i.identifier,position:c,force:F,pressure:n.force||n.pressure||n.webkitForce||0,distance:l,angle:{radian:m,degree:g},vector:{x:d/a,y:-E/a},raw:k,instance:i,lockX:e.lockX,lockY:e.lockY};V=i.computeDirection(V),V.angle={radian:ae(180-g),degree:180-g},i.trigger("move",V),t.trigger("move "+i.id+":move",V)};_.prototype.processOnEnd=function(n){var t=this,e=t.options,s=t.manager.getIdentifier(n),i=t.nipples.get(s),o=t.manager.removeIdentifier(i.identifier);i&&(e.dataOnly||i.hide(function(){e.mode==="dynamic"&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),t.ids.indexOf(i.identifier)>=0&&t.ids.splice(t.ids.indexOf(i.identifier),1),t.actives.indexOf(i)>=0&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(e.mode)?t.idles.push(i):t.nipples.indexOf(i)>=0&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(e.mode)&&(t.manager.ids[o.id]=o.identifier))};_.prototype.onDestroyed=function(n,t){var e=this;e.nipples.indexOf(t)>=0&&e.nipples.splice(e.nipples.indexOf(t),1),e.actives.indexOf(t)>=0&&e.actives.splice(e.actives.indexOf(t),1),e.idles.indexOf(t)>=0&&e.idles.splice(e.idles.indexOf(t),1),e.ids.indexOf(t.identifier)>=0&&e.ids.splice(e.ids.indexOf(t.identifier),1),e.manager.removeIdentifier(t.identifier),e.manager.unbindDocument()};_.prototype.destroy=function(){var n=this;n.unbindEvt(n.options.zone,"start"),n.nipples.forEach(function(e){e.destroy()});for(var t in n.pressureIntervals)n.pressureIntervals.hasOwnProperty(t)&&clearInterval(n.pressureIntervals[t]);n.trigger("destroyed",n.nipples),n.manager.unbindDocument(),n.off()};function O(n){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=He(),t.config(n),t.prepareCollections();var e=function(){var i;t.collections.forEach(function(o){o.forEach(function(r){i=r.el.getBoundingClientRect(),r.position={x:t.scroll.x+i.left,y:t.scroll.y+i.top}})})};Rt(window,"resize",function(){ke(e)});var s=function(){t.scroll=He()};return Rt(window,"scroll",function(){ke(s)}),t.collections}O.prototype=new q;O.constructor=O;O.prototype.prepareCollections=function(){var n=this;n.collections.create=n.create.bind(n),n.collections.on=n.on.bind(n),n.collections.off=n.off.bind(n),n.collections.destroy=n.destroy.bind(n),n.collections.get=function(t){var e;return n.collections.every(function(s){return e=s.get(t),!e}),e}};O.prototype.create=function(n){return this.createCollection(n)};O.prototype.createCollection=function(n){var t=this,e=new _(t,n);return t.bindCollection(e),t.collections.push(e),e};O.prototype.bindCollection=function(n){var t=this,e,s=function(i,o){e=i.type+" "+o.id+":"+i.type,t.trigger(e,o)};n.on("destroyed",t.onDestroyed.bind(t)),n.on("shown hidden rested dir plain",s),n.on("dir:up dir:right dir:down dir:left",s),n.on("plain:up plain:right plain:down plain:left",s)};O.prototype.bindDocument=function(){var n=this;n.binded||(n.bindEvt(document,"move").bindEvt(document,"end"),n.binded=!0)};O.prototype.unbindDocument=function(n){var t=this;(!Object.keys(t.ids).length||n===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};O.prototype.getIdentifier=function(n){var t;return n?(t=n.identifier===void 0?n.pointerId:n.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};O.prototype.removeIdentifier=function(n){var t={};for(var e in this.ids)if(this.ids[e]===n){t.id=e,t.identifier=this.ids[e],delete this.ids[e];break}return t};O.prototype.onmove=function(n){var t=this;return t.onAny("move",n),!1};O.prototype.onend=function(n){var t=this;return t.onAny("end",n),!1};O.prototype.oncancel=function(n){var t=this;return t.onAny("end",n),!1};O.prototype.onAny=function(n,t){var e=this,s,i="processOn"+n.charAt(0).toUpperCase()+n.slice(1);t=Bi(t);var o=function(a,c,l){l.ids.indexOf(c)>=0&&(l[i](a),a._found_=!0)},r=function(a){s=e.getIdentifier(a),le(e.collections,o.bind(null,a,s)),a._found_||e.removeIdentifier(s)};return le(t,r),!1};O.prototype.destroy=function(){var n=this;n.unbindDocument(!0),n.ids={},n.index=0,n.collections.forEach(function(t){t.destroy()}),n.off()};O.prototype.onDestroyed=function(n,t){var e=this;if(e.collections.indexOf(t)<0)return!1;e.collections.splice(e.collections.indexOf(t),1)};const Xe=new O,Ye={create:function(n){return Xe.create(n)},factory:Xe};var Oo=Object.defineProperty,So=Object.getOwnPropertyDescriptor,_t=(n,t,e,s)=>{for(var i=s>1?void 0:s?So(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Oo(t,e,i),i};class et extends u{constructor(){super(...arguments),this.onlyMobile=!0,this.movementSensitivity=1,this.lookSensitivity=5,this.maxDoubleTapDelay=200,this.onJump=new b,this.onMove=new b,this.onLook=new b,this._movementIsActive=!1,this._lookIsActive=!1,this._htmlElements=[]}awake(){console.log(this.moveJoyColor),this._lookVector=new M,this._movementVector=new M}onEnable(){if(!oi()&&this.onlyMobile)return;const t=document.createElement("div");t.id="look-joystick",t.style.cssText=`
                position: absolute;
                top: 0%;
                left: 0%;
                width: 100%;
                height: 100%;
                user-select: none;
                -webkit-user-select: none;
                -webkit-touch-callout: none;
            `;const e=document.createElement("div");e.id="movement-joystick",e.style.cssText=`
                position: absolute;
                bottom: 0;
                left: 0;
                width:  200px;
                height: 200px;
                user-select: none;
                -webkit-user-select: none;
                -webkit-touch-callout: none;
            `,this.context.domElement.append(t),this.context.domElement.append(e),this._htmlElements.push(t),this._htmlElements.push(e);const s=10;this._movement=Ye.create({mode:"static",position:{left:"50%",top:"50%"},catchDistance:1e3,zone:e,size:130,color:this.getRGBAColorString(this.moveJoyColor),fadeTime:0}),this._movement.on("start",()=>{this._movementIsActive=!0}),this._movement.on("move",(r,a)=>{a.distance>s?this._movementVector.set(a.vector.x,a.vector.y).multiplyScalar(this.movementSensitivity):this._movementVector.set(0,0)}),this._movement.on("end",()=>{this._movementIsActive=!1});const i=130/2;this._look=Ye.create({mode:"dynamic",catchDistance:1e3,maxNumberOfNipples:1,zone:t,size:130,color:this.getRGBAColorString(this.lookJoyColor),fadeTime:0}),this._look.on("start",()=>{this._lookIsActive=!0}),this._look.on("move",(r,a)=>{a.distance>s?this._lookVector.set(a.vector.x,a.vector.y*-1).multiplyScalar(this.lookSensitivity*a.distance/i):this._lookVector.set(0,0)});let o=0;this._look.on("end",()=>{var a;this._lookIsActive=!1;const r=Date.now();r-o<this.maxDoubleTapDelay&&((a=this.onJump)==null||a.invoke()),o=r})}onDisable(){var t,e;(t=this._movement)==null||t.destroy(),(e=this._look)==null||e.destroy();for(const s of this._htmlElements)s.remove();this._htmlElements.length=0}update(){var t,e;this._movementIsActive&&((t=this.onMove)==null||t.invoke(this._movementVector)),this._lookIsActive&&((e=this.onLook)==null||e.invoke(this._lookVector))}getRGBAColorString(t){return`rgba(${t.r*255}, ${t.g*255}, ${t.b*255}, ${t.a})`}}_t([h(ue)],et.prototype,"moveJoyColor",2);_t([h(ue)],et.prototype,"lookJoyColor",2);_t([h(b)],et.prototype,"onJump",2);_t([h(b)],et.prototype,"onMove",2);_t([h(b)],et.prototype,"onLook",2);var Co=Object.defineProperty,Io=Object.getOwnPropertyDescriptor,Vi=(n,t,e,s)=>{for(var i=s>1?void 0:s?Io(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Co(t,e,i),i};const Eo=Y("debugspawnhandler");class je extends u{constructor(){super(...arguments),this.spawnPoints=[],this.downVector=new y(0,-1,0)}handlePlayerSpawn(t){this.spawnPoints.sort(()=>Math.random()-.5);const e=new ri;e.layerMask=new hi,e.layerMask.enableAll(),e.ray=new di(new y,this.downVector.clone()),e.maxDistance=2;let s;for(let a=0;a<this.spawnPoints.length;a++){const c=this.spawnPoints[a];if(c.getWorldPosition(e.ray.origin),e.ray.origin.y+=3,e.ray.direction.copy(this.downVector),Eo&&$t.DrawLine(e.ray.origin,e.ray.origin.clone().add(e.ray.direction.clone().multiplyScalar(e.maxDistance)),16711680,50,!0),this.context.physics.raycast(e).length==0){s=c;break}}const i=(s==null?void 0:s.position.clone())||new y,o=(s==null?void 0:s.rotation.clone())||new pi;t instanceof $&&(t.worldToLocal(i),t.position.copy(i),t.rotation.copy(o));const r=t==null?void 0:t.getComponent(I);r&&this.mobileControls&&(this.mobileControls.onLook.addEventListener(a=>r.look(a)),this.mobileControls.onMove.addEventListener(a=>r.move(a)),this.mobileControls.onJump.addEventListener(()=>r.jump()))}}Vi([h($)],je.prototype,"spawnPoints",2);Vi([h(et)],je.prototype,"mobileControls",2);p.add("FirstPersonController",I);p.add("PointerLock",it);p.add("MobileControls",et);p.add("SpawnHandler",je);var Do=Object.defineProperty,jo=Object.getOwnPropertyDescriptor,Mo=(n,t,e,s)=>{for(var i=s>1?void 0:s?jo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Do(t,e,i),i};const St=Y("debugsyncanimator"),Ni=class extends u{constructor(){super(...arguments),this.syncedAnimGuid=null,this.localParameters=[],this.currentController=null,this.isSyncAnim=!0,this.tempValues=[],this.modelRecieved=n=>{var s,i;if(!this.animator)return;St&&console.log(`${this.context.time.time.toFixed(2)} SyncAnimator incoming message`);for(let o=0;o<n.values.length;o++){const r=this.localParameters[o],a=n.values[o];var t=null;switch(r.type){case S.Trigger:case S.Bool:t=a==1;break;case S.Float:case S.Int:t=a||0;break}t!==r.value&&(St&&console.log(`Remote parameter: ${r.name} | ${r.value} --> ${t}`),r.value=t)}const e=n.state;if(e!==0){const o=(s=this.animator.runtimeAnimatorController)==null?void 0:s.findState(e);this.remoteState=o,St&&console.log(`${this.context.time.time.toFixed(2)} Remote state: ${(i=this.currentState)==null?void 0:i.name} --> ${o==null?void 0:o.name}`)}}}set SyncedAnimGuid(n){this.unregisterNetMessage(),this.syncedAnimGuid=n,this.registerNetMessage()}get SyncedAnimGuid(){return this.syncedAnimGuid}get currentState(){var n,t;return(t=(n=this.animator)==null?void 0:n.runtimeAnimatorController)==null?void 0:t.activeState}start(){this.SyncedAnimGuid??(this.SyncedAnimGuid=`${this.guid}`),this.enabled=this.localParameters!==void 0,this.enabled||console.warn("SyncAnimator has to be on an object with an Animator componenet")}onControllerChanged(){var n,t,e;this.animator=this.gameObject.getComponent(Z),this.currentController=(n=this.animator)==null?void 0:n.runtimeAnimatorController,this.localParameters=(e=(t=this.currentController)==null?void 0:t.model)==null?void 0:e.parameters}registerNetMessage(){this.context.connection.beginListen(this.syncedAnimGuid,this.modelRecieved)}unregisterNetMessage(){this.context.connection.stopListen(this.syncedAnimGuid,this.modelRecieved)}onDestroy(){this.unregisterNetMessage()}onBeforeRender(){if(this.isSyncAnim!==void 0)return;const n=this.gameObject.getComponent(Ni);!n||!n.enabled||(n.syncedAnimatorUpdate(),n.applyRemoteState(),n.dispatchChanges())}syncedAnimatorUpdate(){var n;this.currentController!==((n=this.animator)==null?void 0:n.runtimeAnimatorController)&&this.onControllerChanged()}applyRemoteState(){var n;this.remoteState&&this.remoteState!==this.currentState&&((n=this.animator.runtimeAnimatorController)==null||n.play(this.remoteState.hash),this.remoteState=null)}dispatchChanges(){!this.animator.parametersAreDirty&&!this.animator.isDirty||this.createAndSndModel(this.localParameters,this.animator.isDirty?this.currentState:void 0)}createAndSndModel(n,t){const e=this.context.connection;if(!e.isInRoom)return;this.tempValues.length=n.length;for(let o=0;o<n.length;o++){const r=n[o];var s=0;switch(r.type){case S.Trigger:case S.Bool:s=r.value?1:0;break;case S.Float:case S.Int:s=r.value;break}this.tempValues[o]=s}const i={guid:this.syncedAnimGuid,values:this.tempValues,state:(t==null?void 0:t.hash)||0};St&&console.log(`${this.context.time.time.toFixed(2)} SyncAnimator outgoing message`),e.send(this.guid,i)}};let Wt=Ni;Mo([ps(Z)],Wt.prototype,"onBeforeRender",1);var To=Object.defineProperty,Ro=Object.getOwnPropertyDescriptor,Q=(n,t,e,s)=>{for(var i=s>1?void 0:s?Ro(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&To(t,e,i),i};class rt extends u{constructor(){super(...arguments),this.animParam="",this.animParamToDisable=""}awake(){var e,s,i;const t=(i=(s=(e=this.animator)==null?void 0:e.runtimeAnimatorController)==null?void 0:s.model)==null?void 0:i.parameters;t&&(this.parameter=t.find(o=>o.name===this.animParam))}onPointerClick(t){var i,o,r;if(!this.animator||!this.syncAnimator||!this.parameter)return;const e=this.parameter.type;if(e==S.Float){var s=this.animator.getFloat(this.animParam)+.6;s>=1.7&&(s=0),this.animator.setFloat(this.animParam,s)}if((e==S.Bool||e==S.Trigger)&&this.animator.setBool(this.animParam,!this.parameter.value),this.animParamToDisable!=""){const a=(r=(o=(i=this.animator)==null?void 0:i.runtimeAnimatorController)==null?void 0:o.model)==null?void 0:r.parameters;if(!a)return;const c=a.find(l=>l.name===this.animParamToDisable);if(c){const l=c.type;l==S.Float||l==S.Int?this.animator.setFloat(this.animParamToDisable,0):(l==S.Bool||l==S.Trigger)&&this.animator.setBool(this.animParamToDisable,!1)}}}update(){if(this.parameter&&this.valueLabel){var t="";this.parameter.type==S.Float||this.parameter.type==S.Int?t=this.parameter.value.toFixed(1):t=`${this.parameter.value}`,this.valueLabel.text=t}}}Q([h(Z)],rt.prototype,"animator",2);Q([h(Wt)],rt.prototype,"syncAnimator",2);Q([h()],rt.prototype,"animParam",2);Q([h()],rt.prototype,"animParamToDisable",2);Q([h(D)],rt.prototype,"valueLabel",2);class Xt extends u{constructor(){super(...arguments),this.animName=""}onPointerClick(t){this.animator&&this.syncAnimator&&this.animator.play(this.animName)}}Q([h(Z)],Xt.prototype,"animator",2);Q([h(Wt)],Xt.prototype,"syncAnimator",2);Q([h()],Xt.prototype,"animName",2);const se=2,U=4,H=4,Ui=4,J=new Int32Array(2),qe=new Float32Array(J.buffer),Je=new Float64Array(J.buffer),Ct=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class W{constructor(t,e){this.low=t|0,this.high=e|0}static create(t,e){return t==0&&e==0?W.ZERO:new W(t,e)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(t){return this.low==t.low&&this.high==t.high}}W.ZERO=new W(0,0);var ce;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(ce||(ce={}));class Lt{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Lt(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new W(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new W(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return J[0]=this.readInt32(t),qe[0]}readFloat64(t){return J[Ct?0:1]=this.readInt32(t),J[Ct?1:0]=this.readInt32(t+4),Je[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){qe[0]=e,this.writeInt32(t,J[0])}writeFloat64(t,e){Je[0]=e,this.writeInt32(t,J[Ct?0:1]),this.writeInt32(t+4,J[Ct?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+U+H)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<H;e++)t+=String.fromCharCode(this.readInt8(this.position_+U+e));return t}__offset(t,e){const s=t-this.readInt32(t);return e<this.readInt16(s)?this.readInt16(s+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const s=this.readInt32(t);let i="",o=0;if(t+=U,e===ce.UTF8_BYTES)return this.bytes_.subarray(t,t+s);for(;o<s;){let r;const a=this.readUint8(t+o++);if(a<192)r=a;else{const c=this.readUint8(t+o++);if(a<224)r=(a&31)<<6|c&63;else{const l=this.readUint8(t+o++);if(a<240)r=(a&15)<<12|(c&63)<<6|l&63;else{const g=this.readUint8(t+o++);r=(a&7)<<18|(c&63)<<12|(l&63)<<6|g&63}}}r<65536?i+=String.fromCharCode(r):(r-=65536,i+=String.fromCharCode((r>>10)+55296,(r&1024-1)+56320))}return i}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+U}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=H)throw new Error("FlatBuffers: file identifier must be length "+H);for(let e=0;e<H;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+U+e))return!1;return!0}createLong(t,e){return W.create(t,e)}createScalarList(t,e){const s=[];for(let i=0;i<e;++i)t(i)!==null&&s.push(t(i));return s}createObjList(t,e){const s=[];for(let i=0;i<e;++i){const o=t(i);o!==null&&s.push(o.unpack())}return s}}class Me{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let e;t?e=t:e=1024,this.bb=Lt.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const s=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<s+t+e;){const i=this.bb.capacity();this.bb=Me.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(s)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,s){(this.force_defaults||e!=s)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,s){(this.force_defaults||e!=s)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,s){(this.force_defaults||e!=s)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,s){(this.force_defaults||!e.equals(s))&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,s){(this.force_defaults||e!=s)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,s){(this.force_defaults||e!=s)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,s){(this.force_defaults||e!=s)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,s){e!=s&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const s=e<<1,i=Lt.allocate(s);return i.setPosition(s-e),i.bytes().set(t.bytes(),s-e),i}addOffset(t){this.prep(U,0),this.writeInt32(this.offset()-t+U)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const s=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const i=2;this.addInt16(t-this.object_start);const o=(s+i)*se;this.addInt16(o);let r=0;const a=this.space;t:for(e=0;e<this.vtables.length;e++){const c=this.bb.capacity()-this.vtables[e];if(o==this.bb.readInt16(c)){for(let l=se;l<o;l+=se)if(this.bb.readInt16(a+l)!=this.bb.readInt16(c+l))continue t;r=this.vtables[e];break}}return r?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,r-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,s){const i=s?Ui:0;if(e){const o=e;if(this.prep(this.minalign,U+H+i),o.length!=H)throw new Error("FlatBuffers: file identifier must be length "+H);for(let r=H-1;r>=0;r--)this.writeInt8(o.charCodeAt(r))}this.prep(this.minalign,U+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const s=this.bb.capacity()-t,i=s-this.bb.readInt32(s);if(!(this.bb.readInt16(i+e)!=0))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,s){this.notNested(),this.vector_num_elems=e,this.prep(U,t*e),this.prep(s,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let s=0;for(;s<t.length;){let i;const o=t.charCodeAt(s++);if(o<55296||o>=56320)i=o;else{const r=t.charCodeAt(s++);i=(o<<10)+r+(65536-56623104-56320)}i<128?e.push(i):(i<2048?e.push(i>>6&31|192):(i<65536?e.push(i>>12&15|224):e.push(i>>18&7|240,i>>12&63|128),e.push(i>>6&63|128)),e.push(i&63|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let s=0,i=this.space,o=this.bb.bytes();s<e.length;s++)o[i++]=e[s];return this.endVector()}createLong(t,e){return W.create(t,e)}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(i!==null)e.push(this.createObjectOffset(i));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}}class P{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSendBuffer_Model(t,e){return(e||new P).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSendBuffer_Model(t,e){return t.setPosition(t.position()+Ui),(e||new P).__init(t.readInt32(t.position())+t.position(),t)}guid(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}guidLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}guidArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}dontSave(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}prefix(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}seconds(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0}static startSendBuffer_Model(t){t.startObject(4)}static addGuid(t,e){t.addFieldOffset(0,e,0)}static createGuidVector(t,e){t.startVector(1,e.length,1);for(let s=e.length-1;s>=0;s--)t.addInt8(e[s]);return t.endVector()}static startGuidVector(t,e){t.startVector(1,e,1)}static addDontSave(t,e){t.addFieldInt8(1,+e,0)}static addPrefix(t,e){t.addFieldOffset(2,e,0)}static addSeconds(t,e){t.addFieldInt32(3,e,0)}static endSendBuffer_Model(t){return t.endObject()}static finishSendBuffer_ModelBuffer(t,e){t.finish(e)}static finishSizePrefixedSendBuffer_ModelBuffer(t,e){t.finish(e,void 0,!0)}static createSendBuffer_Model(t,e,s,i,o){return P.startSendBuffer_Model(t),P.addGuid(t,e),P.addDontSave(t,s),P.addPrefix(t,i),P.addSeconds(t,o),P.endSendBuffer_Model(t)}}var ki={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(us,function(){return function(e){var s={};function i(o){if(s[o])return s[o].exports;var r=s[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=s,i.d=function(o,r,a){i.o(o,r)||Object.defineProperty(o,r,{enumerable:!0,get:a})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,r){if(1&r&&(o=i(o)),8&r||4&r&&typeof o=="object"&&o&&o.__esModule)return o;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:o}),2&r&&typeof o!="string")for(var c in o)i.d(a,c,function(l){return o[l]}.bind(null,c));return a},i.n=function(o){var r=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(r,"a",r),r},i.o=function(o,r){return Object.prototype.hasOwnProperty.call(o,r)},i.p="",i(i.s=0)}([function(e,s,i){i.r(s),i.d(s,"UuidTool",function(){return a}),i.d(s,"Uuid",function(){return r});var o={uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i},r=function(){function c(l){this.id="",typeof l=="string"?this.fromString(l):Array.isArray(l)?this.fromBytes(l):this.generate()}return c.fromJson=function(l){if(typeof l=="string"&&(l=JSON.parse(l)),!l||!l.id)throw new TypeError("The input cannot be converted to Uuid.");return new c(l.id)},c.prototype.generate=function(){var l=new Array(16).fill(0).map(function(){return 256*Math.random()&255});return l[6]=79&(64|l[6]),this.fromBytes(l),this},c.prototype.fromBytes=function(l){return this.id=l.map(function(g){return("00"+g.toString(16)).slice(-2)}).join("").replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5"),this.id=this.toString(),this},c.prototype.toBytes=function(){return(this.id.replace(/-/g,"").match(/.{2}/g)||[]).map(function(l){return parseInt(l,16)})},c.prototype.fromString=function(l){return this.id=l.trim(),this.id=this.toString(),this},c.prototype.toString=function(){switch(c.stringExportFormat){default:case"lowercase":return this.id.toLowerCase();case"uppercase":return this.id.toUpperCase()}},c.prototype.isValid=function(){return typeof this.id=="string"&&this.id.length===36&&o.uuid.test(this.id)},c.prototype.equals=function(l){return typeof l=="string"&&(l=new c(l)),this.toString()===l.toString()},c.stringExportFormat="lowercase",c}(),a=function(){function c(){}return c.toBytes=function(l){return new r().fromString(l).toBytes()},c.toString=function(l){return new r().fromBytes(l).toString()},c.newUuid=function(){return new r().toString()},c.isUuid=function(l){return new r().fromString(l).isValid()},c.compare=function(l,g){return new r(l).equals(new r(g))},c}()}])})})(ki);var Lo=ki.exports,Ao=Object.defineProperty,$o=Object.getOwnPropertyDescriptor,Yt=(n,t,e,s)=>{for(var i=s>1?void 0:s?$o(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ao(t,e,i),i};const Dt="MESG";ms(Dt,P.getRootAsSendBuffer_Model);class xt extends u{constructor(){super(...arguments),this.saveState=!0,this.recieveBuffer=t=>{this.msgLabel&&(this.msgLabel.text=`${t.prefix()} ${t.seconds()}`)}}onEnable(){this.context.connection.beginListenBinary(Dt,this.recieveBuffer)}onDisable(){this.context.connection.stopListenBinary(Dt,this.recieveBuffer)}sendBuffer(){const t=new Me(0),e=P.createGuidVector(t,Lo.UuidTool.toBytes(this.guid)),s=!this.saveState,i=t.createString("Hello, it is "),o=Math.floor(this.context.time.time);console.log(e),P.startSendBuffer_Model(t),P.addGuid(t,e),P.addDontSave(t,s),P.addPrefix(t,i),P.addSeconds(t,o);const r=P.endSendBuffer_Model(t);t.finish(r,Dt);const a=t.asUint8Array();this.context.connection.sendBinary(a),this.outgoingSizeLabel&&(this.outgoingSizeLabel.text=`${a.length} bytes`)}deleteState(){this.context.connection.sendDeleteRemoteState(this.guid)}awake(){this.updateSaveStateLabel()}toggleSaveState(){this.saveState=!this.saveState,this.updateSaveStateLabel()}updateSaveStateLabel(){this.saveStateLabel&&(this.saveStateLabel.text=`Save state: ${this.saveState}`)}}Yt([h(D)],xt.prototype,"msgLabel",2);Yt([h(D)],xt.prototype,"saveStateLabel",2);Yt([h(D)],xt.prototype,"outgoingSizeLabel",2);Yt([h()],xt.prototype,"saveState",2);var Fo=Object.defineProperty,Bo=Object.getOwnPropertyDescriptor,qt=(n,t,e,s)=>{for(var i=s>1?void 0:s?Bo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Fo(t,e,i),i};class Pt extends u{constructor(){super(...arguments),this.saveState=!0,this.msgId="SendMessage",this.recieveMessage=t=>{this.msgLabel&&(this.msgLabel.text=`${t.prefix} ${t.seconds}`)}}onEnable(){this.context.connection.beginListen(this.msgId,this.recieveMessage)}onDisable(){this.context.connection.stopListen(this.msgId,this.recieveMessage)}sendMessage(){const t={guid:this.guid,dontSave:!this.saveState,prefix:"Hello, it is ",seconds:Math.floor(this.context.time.time)};if(this.context.connection.send(this.msgId,t),this.outgoingSizeLabel){const e=new TextEncoder().encode(JSON.stringify(t));this.outgoingSizeLabel.text=`${e.length} bytes`}}deleteState(){this.context.connection.sendDeleteRemoteState(this.guid)}awake(){this.updateSaveStateLabel()}toggleSaveState(){this.saveState=!this.saveState,this.updateSaveStateLabel()}updateSaveStateLabel(){this.saveStateLabel&&(this.saveStateLabel.text=`Save state: ${this.saveState}`)}}qt([h(D)],Pt.prototype,"msgLabel",2);qt([h(D)],Pt.prototype,"saveStateLabel",2);qt([h(D)],Pt.prototype,"outgoingSizeLabel",2);qt([h()],Pt.prototype,"saveState",2);var zo=Object.defineProperty,Vo=Object.getOwnPropertyDescriptor,No=(n,t,e,s)=>{for(var i=s>1?void 0:s?Vo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&zo(t,e,i),i};class Gi extends u{constructor(){super(...arguments),this.msgId="EventListOnClick",this.model=new Uo}onEnable(){this.onClickMsgHandler=this.handleOnClickMsg.bind(this),this.context.connection.beginListen(this.msgId,this.onClickMsgHandler)}onDisable(){this.context.connection.stopListen(this.msgId,this.onClickMsgHandler)}handleOnClickMsg(t){t.id===this.guid&&this.callEventList()}onPointerClick(t){this.callEventList(),this.model.id=this.guid,this.context.connection.send(this.msgId,this.model)}callEventList(){var t;(t=this.onClicked)==null||t.invoke()}}No([h(b)],Gi.prototype,"onClicked",2);class Uo{constructor(){this.id=""}}var ko=Object.defineProperty,Go=Object.getOwnPropertyDescriptor,Ho=(n,t,e,s)=>{for(var i=s>1?void 0:s?Go(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&ko(t,e,i),i};class Hi extends u{constructor(){super(...arguments),this.updateLabel=()=>{this.label&&this.playerState&&(this.label.text=`${this.playerState.owner}
${this.playerState.isLocalPlayer?"<color=#ff715e>Local</color>":"Remote"}`)}}start(){this.playerState=this.gameObject.getComponentInParent(me),this.playerState&&(this.playerState.hasOwner?this.updateLabel():this.playerState.onFirstOwnerChangeEvent.addEventListener(this.updateLabel))}}Ho([h(D)],Hi.prototype,"label",2);var Wo=Object.defineProperty,Xo=Object.getOwnPropertyDescriptor,Jt=(n,t,e,s)=>{for(var i=s>1?void 0:s?Xo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Wo(t,e,i),i};class Ot extends u{constructor(){super(...arguments),this.speed=5,this.currentGoal=new y,this.pointerPos=new M,this.tempVec1=new y,this.tempVec2=new y,this.initialize=()=>{var s;if(!this.playerState||!this.mainRenderer)return;this.syncedTransform&&((s=this.playerState)!=null&&s.isLocalPlayer)&&this.syncedTransform.requestOwnership();const t=this.playerState.owner??"",e=this.mainRenderer.sharedMaterial;if(e){const i=new li;i.copy(e);const o=parseInt(t,16);i.color=new ut(o),this.mainRenderer.sharedMaterial=i}}}start(){this.playerState&&(this.playerState.hasOwner?this.initialize():this.playerState.onFirstOwnerChangeEvent.addEventListener(this.initialize),this.currentGoal.copy(this.gameObject.position))}update(){var t;if((t=this.playerState)!=null&&t.isLocalPlayer){const e=this.context.input,s=this.context.mainCamera,i=this.context.time.deltaTime,o=this.context.physics.engine;this.tempVec1.copy(this.currentGoal),this.tempVec2.copy(this.gameObject.position);const r=this.tempVec1.sub(this.tempVec2),a=this.speed*i;r.length()<a?this.gameObject.position.copy(this.currentGoal):this.gameObject.translateOnAxis(r.normalize(),a);const c=!1;if(e.getPointerDown(0)){const l=e.getPointerPosition(0);l&&this.pointerPos.copy(l)}if(e.getPointerUp(0)&&s&&((e.getPointerPosition(0)||new M).distanceTo(this.pointerPos)<40||c)){const g=o.raycast();g&&g.collider&&this.currentGoal.copy(g.point)}}}}Jt([h(me)],Ot.prototype,"playerState",2);Jt([h(ni)],Ot.prototype,"syncedTransform",2);Jt([h(nt)],Ot.prototype,"mainRenderer",2);Jt([h()],Ot.prototype,"speed",2);var Yo=Object.defineProperty,qo=Object.getOwnPropertyDescriptor,Te=(n,t,e,s)=>{for(var i=s>1?void 0:s?qo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Yo(t,e,i),i};const Jo=Y("debugspawnhandler");class Kt extends u{constructor(){super(...arguments),this.spawnPoints=[],this.validIndex=-1,this.offsetForError=1,this.downVector=new y(0,-1,0),this.upVector=new y(0,1,0),this.offsetVector=new y}handlePlayerSpawn(t){const e=new ri;e.layerMask=new hi,e.layerMask.enableAll(),e.ray=new di(new y,this.downVector.clone()),e.maxDistance=2;let s;this.validIndex+1>=this.spawnPoints.length?this.validIndex=0:this.validIndex++;for(let r=this.validIndex;r<this.spawnPoints.length;r++){const a=this.spawnPoints[r];if(a.getWorldPosition(e.ray.origin),e.ray.origin.y+=3,e.ray.direction.copy(this.downVector),Jo&&$t.DrawLine(e.ray.origin,e.ray.origin.clone().add(e.ray.direction.clone().multiplyScalar(e.maxDistance)),16711680,50,!0),this.context.physics.raycast(e).length==0){s=a,this.validIndex=r;break}}s||console.log("No available spawn");const i=(s==null?void 0:s.position.clone())||new y,o=(s==null?void 0:s.rotation.clone())||new pi;this.offsetVector.set(0,0,this.offsetForError),this.offsetVector.applyAxisAngle(this.upVector,Math.random()*Math.PI*2),i.add(this.offsetVector),t instanceof $&&(t.worldToLocal(i),t.position.copy(i),t.rotation.copy(o))}}Te([h($)],Kt.prototype,"spawnPoints",2);Te([tt()],Kt.prototype,"validIndex",2);Te([h()],Kt.prototype,"offsetForError",2);var Ko=Object.defineProperty,Qo=Object.getOwnPropertyDescriptor,Re=(n,t,e,s)=>{for(var i=s>1?void 0:s?Qo(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ko(t,e,i),i};class ft extends u{constructor(){super(...arguments),this.model=new Zo}awake(){this.onModelChanged()}updateUser(){var e;this.model.guid=this.guid;let t=this.model.users.find(s=>s.userId==this.context.connection.connectionId);t||(t=new tr,this.model.users.push(t)),t.userId=this.context.connection.connectionId,t.nickname=(e=this.inputField)==null?void 0:e.text,this.model=this.model}onModelChanged(){if(A("Room data recieved"),this.displayLabel){const t=this.model.users.map(e=>`${e.nickname}`).join(`
`);this.displayLabel.text=t.length>0?t:"no data"}}}Re([tt(ft.prototype.onModelChanged)],ft.prototype,"model",2);Re([h(D)],ft.prototype,"displayLabel",2);Re([h(ai)],ft.prototype,"inputField",2);class Zo{constructor(){this.guid="",this.users=[]}}class tr{constructor(){this.userId="",this.nickname=""}}var er=Object.defineProperty,ir=Object.getOwnPropertyDescriptor,Le=(n,t,e,s)=>{for(var i=s>1?void 0:s?ir(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&er(t,e,i),i};class Qt extends u{update(){var a;if((a=this.gameObject.getComponent(X))==null||a.lockPositionX,!this.roomLabel||!this.usersLabel)return;const t=this.context.connection,e=t.currentRoomName||"",s=t.connectionId||"",i=t.currentRoomViewId||"";this.roomLabel.text=t.isInRoom?`Joined:
${e}
(${s}) (${i})
${t.currentLatency.toFixed(2)}ms`:"Not in a room";const o=t.usersInRoom().join(`
`),r=o.length>0?o:"no users";this.usersLabel.text=t.isInRoom?r:""}joinRoom(){const t=this.context.connection;this.roomNameInput&&(t.isInRoom?A("You are already in a room, you have to leave it first!",ti.Warn):t.joinRoom(this.roomNameInput.text))}disconnectRoom(){const t=this.context.connection;t.isInRoom&&t.leaveRoom()}}Le([h(D)],Qt.prototype,"roomLabel",2);Le([h(D)],Qt.prototype,"usersLabel",2);Le([h(ai)],Qt.prototype,"roomNameInput",2);p.add("SyncedAnimator",Wt);p.add("SyncedAnimatorControls_RandomValue",rt);p.add("SyncedAnimatorControls_PlayAnim",Xt);p.add("SendBufferExample",xt);p.add("SendBuffer_Model",P);p.add("SendMessageExample",Pt);p.add("TriggerEventListOnClick",Gi);p.add("PlayerStateUI",Hi);p.add("SampleNetworkedPlayer",Ot);p.add("SpawnSpotHandler",Kt);p.add("RoomData",ft);p.add("RoomManager",Qt);var sr=Object.defineProperty,nr=Object.getOwnPropertyDescriptor,or=(n,t,e,s)=>{for(var i=s>1?void 0:s?nr(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&sr(t,e,i),i};class Ae extends u{constructor(){super(...arguments),this.controls=null}onEnable(){this.controls=w.findObjectOfType(At)}setView(){!this.controls||!this.lookAt||(this.controls.setLookTargetPosition(ot(this.lookAt)),this.controls.setCameraTargetPosition(ot(this.gameObject)))}}or([h(w)],Ae.prototype,"lookAt",2);var rr=Object.defineProperty,ar=Object.getOwnPropertyDescriptor,Wi=(n,t,e,s)=>{for(var i=s>1?void 0:s?ar(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&rr(t,e,i),i};class $e extends u{constructor(){super(...arguments),this.centerPoints=[],this.camPos=new y,this.currentCenterPoint=null,this.startX=0,this.startTime=0}template(){return`
            <div>
                <div class="spatial-audio-ui">
                    <button class="left">‹</button>
                    <p class="name">Instrument</p>
                    <span>Swipe or tap to change</span>
                    <button class="right">›</button>
                </div>

                <div class="explainer">
                    <div>
                        <h1 class="ignore-landscape">Spatial Audio</h1>
                        <p>Sound on! 🔊</p>
                        <p>This sample demonstrates how to use spatial audio in <a href="https://needle.tools">Needle Engine</a>. Audio sources can be placed in 3D, and your camera position influences how loud they are.</p>
                        <p>You can move around the scene in the browser, open the page on your phone and try it in Augmented Reality, or in Virtual Reality on a VR headset.</p>
                        <button class="start">Start exploring</button><br class="ignore-landscape"/>
                    </div>
                </div>
            </div>
        `}style(){return`
            .spatial-audio-ui {
                position: absolute;
                top: 50px;
                left: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                transform: translateX(-50%);
                vertical-align: middle;
                min-width: 100%; /* to avoid text wrapping */
            }

            .spatial-audio-ui button {
                outline: none;
                border: none;
                background: none;
                font-size: 4rem;
                color: white;
                transition: transform 0.2s;
            }

            .spatial-audio-ui button:hover {
                cursor: pointer;
                transform: scale(1.4);
            }

            .spatial-audio-ui span {
                position: absolute;
                font-size: 1rem;
                color: white;
                opacity: 0.3;
                top: 0px;
                text-align: center;
            }

            .spatial-audio-ui p {
                font-size: 2rem;
                color: white;
                margin: 0 1rem;
                margin-top: 0.6rem;
                text-transform: uppercase;
                text-align: center;
                position: relative;
            }

            .explainer {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                text-align: center;
                color: white;
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .explainer h1 {
                text-transform: uppercase;
                font-weight: 400;
            }

            .explainer > div {
                max-width: min(94vw, 500px);
            }

            .explainer a {
                color: #b9f026;
                text-decoration: none;
                white-space: nowrap;
            }

            .explainer button, .explainer a.button {
                background: white;
                color: black;
                border: none;
                padding: 1rem 2rem;
                font-size: 1rem;
                outline: none;
                transition: transform 0.2s;
                border-radius: 0.5rem;
                margin: 2rem;
            }

            .explainer button.small, .explainer a.button.small {
                padding: 0.5rem 2rem;
                background: #ccc;
            }

            .explainer button:hover, .explainer a.button:hover {
                cursor: pointer;
                transform: scale(1.1);
            }

            @media (max-height: 450px) {
                .ignore-landscape {
                    display: none;
                }
            }

            span {
                text-overflow: ;
            }
        `}onEnable(){var e,s,i,o,r;const t=document.createElement("template");t.innerHTML=this.template(),this.element=(e=t.content.firstElementChild)==null?void 0:e.cloneNode(!0),this.styleElement=document.createElement("style"),this.styleElement.innerHTML=this.style(),this.context.appendHTMLElement(this.element),this.context.appendHTMLElement(this.styleElement),(s=this.element.querySelector(".left"))==null||s.addEventListener("click",()=>{this.changeIndex(-1)}),(i=this.element.querySelector(".right"))==null||i.addEventListener("click",()=>{this.changeIndex(1)}),(o=this.element.querySelector(".name"))==null||o.addEventListener("click",()=>{this.changeIndex(1)}),(r=this.element.querySelector(".start"))==null||r.addEventListener("click",()=>{var a,c;(c=(a=this.element)==null?void 0:a.querySelector(".explainer"))==null||c.remove()}),this._touchstart=this.touchstart.bind(this),this.context.domElement.addEventListener("pointerdown",this._touchstart),this._touchend=this.touchend.bind(this),this.context.domElement.addEventListener("pointerup",this._touchend),this._keydown=this.keydown.bind(this),document.addEventListener("keydown",this._keydown)}changeIndex(t){let e=this.centerPoints.indexOf(this.currentCenterPoint);e+=t,e>=this.centerPoints.length&&(e=0),e<0&&(e=this.centerPoints.length-1),this.centerPoints[e].setView()}onDisable(){var t,e;(t=this.element)==null||t.remove(),(e=this.styleElement)==null||e.remove(),this.context.domElement.removeEventListener("pointerdown",this._touchstart),this.context.domElement.removeEventListener("pointerup",this._touchend)}update(){this.orbitControls&&this.orbitControls.controls&&(this.camPos=this.orbitControls.controls.target);let t=null,e=1/0;for(const s of this.centerPoints){if(!(s!=null&&s.gameObject))continue;const o=ot(s.gameObject).distanceTo(this.camPos);o<e&&(t=s,e=o)}t!==this.currentCenterPoint&&t&&(this.currentCenterPoint=t,this.element&&t.gameObject.parent&&(this.element.querySelector(".name").textContent=t.gameObject.parent.name))}touchstart(t){this.startX=t.clientX,this.startTime=Date.now()}touchend(t){const s=t.clientX-this.startX;Date.now()-this.startTime<250&&Math.abs(s)>20&&(s>0?this.changeIndex(-1):this.changeIndex(1))}keydown(t){t.code==="ArrowLeft"||t.code==="KeyA"?this.changeIndex(-1):(t.code==="ArrowRight"||t.code==="KeyD")&&this.changeIndex(1)}}Wi([h(Ae)],$e.prototype,"centerPoints",2);Wi([h(At)],$e.prototype,"orbitControls",2);p.add("OrbitControlsView",Ae);p.add("SpatialAudioUI",$e);var lr=Object.defineProperty,cr=Object.getOwnPropertyDescriptor,hr=(n,t,e,s)=>{for(var i=s>1?void 0:s?cr(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&lr(t,e,i),i};class Xi extends u{onPointerClick(){this.shake()}shake(){this.animator&&this.animator.setTrigger("shake")}}hr([h(Z)],Xi.prototype,"animator",2);var dr=Object.defineProperty,pr=Object.getOwnPropertyDescriptor,ur=(n,t,e,s)=>{for(var i=s>1?void 0:s?pr(t,e):t,o=n.length-1,r;o>=0;o--)(r=n[o])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&dr(t,e,i),i};class Yi extends u{update(){if(this.label){const t=new Date;this.label.text=`${t.getHours()}:${this.padTo2Digits(t.getMinutes())}`}}padTo2Digits(t){return t.toString().padStart(2,"0")}}ur([h(D)],Yi.prototype,"label",2);p.add("PhoneControoler",Xi);p.add("TimeUI",Yi);
